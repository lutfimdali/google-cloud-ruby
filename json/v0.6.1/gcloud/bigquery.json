{"id":"bigquery","metadata":{"name":"Bigquery","description":"<h1 id=\"google-cloud-bigquery\">Google Cloud BigQuery</h1>  <p>Google Cloud BigQuery enables super-fast, SQL-like queries against massive datasets, using the processing power of Google’s infrastructure. To learn more, read <a href=\"https://cloud.google.com/bigquery/what-is-bigquery\">What is BigQuery?</a>.</p>  <p>Gcloud’s goal is to provide an API that is familiar and comfortable to Rubyists. Authentication is handled by Gcloud#bigquery. You can provide the project and credential information to connect to the BigQuery service, or if you are running on Google Compute Engine this configuration is taken care of for you. You can read more about the options for connecting in the <a href=\"../AUTHENTICATION\">Authentication Guide</a>.</p>  <p>To help you get started quickly, the first few examples below use a public dataset provided by Google. As soon as you have <a href=\"https://cloud.google.com/bigquery/sign-up\">signed up</a> to use BigQuery, and provided that you stay in the free tier for queries, you should be able to run these first examples without the need to set up billing or to load data (although we’ll show you how to do that too.)</p>  <h2 id=\"listing-datasets-and-tables\">Listing Datasets and Tables</h2>  <p>A BigQuery project holds datasets, which in turn hold tables. Assuming that you have not yet created datasets or tables in your own project, let’s connect to Google’s <code class=\"highlighter-rouge\">publicdata</code> project, and see what you find.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"s2\">\"publicdata\"</span> <span class=\"n\">bigquery</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">bigquery</span>  <span class=\"n\">bigquery</span><span class=\"p\">.</span><span class=\"nf\">datasets</span><span class=\"p\">.</span><span class=\"nf\">count</span> <span class=\"c1\">#=&gt; 1</span> <span class=\"n\">bigquery</span><span class=\"p\">.</span><span class=\"nf\">datasets</span><span class=\"p\">.</span><span class=\"nf\">first</span><span class=\"p\">.</span><span class=\"nf\">dataset_id</span> <span class=\"c1\">#=&gt; \"samples\"</span>  <span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">bigquery</span><span class=\"p\">.</span><span class=\"nf\">datasets</span><span class=\"p\">.</span><span class=\"nf\">first</span> <span class=\"n\">tables</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">tables</span>  <span class=\"n\">tables</span><span class=\"p\">.</span><span class=\"nf\">count</span> <span class=\"c1\">#=&gt; 7</span> <span class=\"n\">tables</span><span class=\"p\">.</span><span class=\"nf\">map</span> <span class=\"o\">&amp;</span><span class=\"ss\">:table_id</span> <span class=\"c1\">#=&gt; [..., \"shakespeare\", \"trigrams\", \"wikipedia\"]</span> </code></pre> </div>  <p>In addition listing all datasets and tables in the project, you can also retrieve individual datasets and tables by ID. Let’s look at the structure of the <code class=\"highlighter-rouge\">shakespeare</code> table, which contains an entry for every word in every play written by Shakespeare.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"s2\">\"publicdata\"</span> <span class=\"n\">bigquery</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">bigquery</span>  <span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">bigquery</span><span class=\"p\">.</span><span class=\"nf\">dataset</span> <span class=\"s2\">\"samples\"</span> <span class=\"n\">table</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">table</span> <span class=\"s2\">\"shakespeare\"</span>  <span class=\"n\">table</span><span class=\"p\">.</span><span class=\"nf\">headers</span> <span class=\"c1\">#=&gt; [\"word\", \"word_count\", \"corpus\", \"corpus_date\"]</span> <span class=\"n\">table</span><span class=\"p\">.</span><span class=\"nf\">rows_count</span> <span class=\"c1\">#=&gt; 164656</span> </code></pre> </div>  <p>Now that you know the column names for the Shakespeare table, you can write and run a query.</p>  <h2 id=\"running-queries\">Running queries</h2>  <p>BigQuery offers both synchronous and asynchronous methods, as explained in <a href=\"https://cloud.google.com/bigquery/querying-data\">Querying Data</a>.</p>  <h3 id=\"synchronous-queries\">Synchronous queries</h3>  <p>Let’s start with the simpler synchronous approach. Notice that this time you are connecting using your own default project. This is necessary for running a query, since queries need to be able to create tables to hold results.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">bigquery</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">bigquery</span>  <span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"s2\">\"SELECT TOP(word, 50) as word, COUNT(*) as count \"</span> <span class=\"o\">+</span>       <span class=\"s2\">\"FROM publicdata:samples.shakespeare\"</span> <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">bigquery</span><span class=\"p\">.</span><span class=\"nf\">query</span> <span class=\"n\">sql</span>  <span class=\"n\">data</span><span class=\"p\">.</span><span class=\"nf\">count</span> <span class=\"c1\">#=&gt; 50</span> <span class=\"n\">data</span><span class=\"p\">.</span><span class=\"nf\">next?</span> <span class=\"c1\">#=&gt; false</span> <span class=\"n\">data</span><span class=\"p\">.</span><span class=\"nf\">first</span> <span class=\"c1\">#=&gt; {\"word\"=&gt;\"you\", \"count\"=&gt;42}</span> </code></pre> </div>  <p>The <code class=\"highlighter-rouge\">TOP</code> function shown above is just one of a variety of functions offered by BigQuery. See the <a href=\"https://cloud.google.com/bigquery/query-reference\">Query Reference</a> for a full listing.</p>  <h3 id=\"asynchronous-queries\">Asynchronous queries</h3>  <p>Because you probably should not block for most BigQuery operations, including querying as well as importing, exporting, and copying data, the BigQuery API enables you to manage longer-running jobs. In the asynchronous approach to running a query, an instance of Gcloud::Bigquery::QueryJob is returned, rather than an instance of Gcloud::Bigquery::QueryData.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">bigquery</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">bigquery</span>  <span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"s2\">\"SELECT TOP(word, 50) as word, COUNT(*) as count \"</span> <span class=\"o\">+</span>       <span class=\"s2\">\"FROM publicdata:samples.shakespeare\"</span> <span class=\"n\">job</span> <span class=\"o\">=</span> <span class=\"n\">bigquery</span><span class=\"p\">.</span><span class=\"nf\">query_job</span> <span class=\"n\">sql</span>  <span class=\"n\">job</span><span class=\"p\">.</span><span class=\"nf\">wait_until_done!</span> <span class=\"k\">if</span> <span class=\"o\">!</span><span class=\"n\">job</span><span class=\"p\">.</span><span class=\"nf\">failed?</span>   <span class=\"n\">job</span><span class=\"p\">.</span><span class=\"nf\">query_results</span><span class=\"p\">.</span><span class=\"nf\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">row</span><span class=\"o\">|</span>     <span class=\"nb\">puts</span> <span class=\"n\">row</span><span class=\"p\">[</span><span class=\"s2\">\"word\"</span><span class=\"p\">]</span>   <span class=\"k\">end</span> <span class=\"k\">end</span> </code></pre> </div>  <p>Once you have determined that the job is done and has not failed, you can obtain an instance of Gcloud::Bigquery::QueryData by calling Gcloud::Bigquery::QueryJob#query_results. The query results for both of the above examples are stored in temporary tables with a lifetime of about 24 hours. See the final example below for a demonstration of how to store query results in a permanent table.</p>  <h2 id=\"creating-datasets-and-tables\">Creating Datasets and Tables</h2>  <p>The first thing you need to do in a new BigQuery project is to create a Gcloud::Bigquery::Dataset. Datasets hold tables and control access to them.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud/bigquery\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">bigquery</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">bigquery</span> <span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">bigquery</span><span class=\"p\">.</span><span class=\"nf\">create_dataset</span> <span class=\"s2\">\"my_dataset\"</span> </code></pre> </div>  <p>Now that you have a dataset, you can use it to create a table. Every table is defined by a schema that may contain nested and repeated fields. The example below shows a schema with a repeated record field named <code class=\"highlighter-rouge\">cities_lived</code>. (For more information about nested and repeated fields, see <a href=\"https://cloud.google.com/bigquery/preparing-data-for-bigquery\">Preparing Data for BigQuery</a>.)</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">bigquery</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">bigquery</span> <span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">bigquery</span><span class=\"p\">.</span><span class=\"nf\">dataset</span> <span class=\"s2\">\"my_dataset\"</span>  <span class=\"n\">table</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">create_table</span> <span class=\"s2\">\"people\"</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">schema</span><span class=\"o\">|</span>   <span class=\"n\">schema</span><span class=\"p\">.</span><span class=\"nf\">string</span> <span class=\"s2\">\"first_name\"</span><span class=\"p\">,</span> <span class=\"ss\">mode: :required</span>   <span class=\"n\">schema</span><span class=\"p\">.</span><span class=\"nf\">record</span> <span class=\"s2\">\"cities_lived\"</span><span class=\"p\">,</span> <span class=\"ss\">mode: :repeated</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">nested_schema</span><span class=\"o\">|</span>     <span class=\"n\">nested_schema</span><span class=\"p\">.</span><span class=\"nf\">string</span> <span class=\"s2\">\"place\"</span><span class=\"p\">,</span> <span class=\"ss\">mode: :required</span>     <span class=\"n\">nested_schema</span><span class=\"p\">.</span><span class=\"nf\">integer</span> <span class=\"s2\">\"number_of_years\"</span><span class=\"p\">,</span> <span class=\"ss\">mode: :required</span>   <span class=\"k\">end</span> <span class=\"k\">end</span> </code></pre> </div>  <p>Because of the repeated field in this schema, we cannot use the CSV format to load data into the table.</p>  <h2 id=\"loading-records\">Loading records</h2>  <p>In addition to CSV, data can be imported from files that are formatted as <a href=\"http://jsonlines.org/\">Newline-delimited JSON</a> or <a href=\"http://avro.apache.org/\">Avro</a>, or from a Google Cloud Datastore backup. It can also be “streamed” into BigQuery.</p>  <p>To follow along with these examples, you will need to set up billing on the <a href=\"https://console.developers.google.com\">Google Developers Console</a>.</p>  <h3 id=\"streaming-records\">Streaming records</h3>  <p>For situations in which you want new data to be available for querying as soon as possible, inserting individual records directly from your Ruby application is a great approach.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">bigquery</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">bigquery</span> <span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">bigquery</span><span class=\"p\">.</span><span class=\"nf\">dataset</span> <span class=\"s2\">\"my_dataset\"</span> <span class=\"n\">table</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">table</span> <span class=\"s2\">\"people\"</span>  <span class=\"n\">rows</span> <span class=\"o\">=</span> <span class=\"p\">[</span>     <span class=\"p\">{</span>         <span class=\"s2\">\"first_name\"</span> <span class=\"o\">=&gt;</span> <span class=\"s2\">\"Anna\"</span><span class=\"p\">,</span>         <span class=\"s2\">\"cities_lived\"</span> <span class=\"o\">=&gt;</span> <span class=\"p\">[</span>             <span class=\"p\">{</span>                 <span class=\"s2\">\"place\"</span> <span class=\"o\">=&gt;</span> <span class=\"s2\">\"Stockholm\"</span><span class=\"p\">,</span>                 <span class=\"s2\">\"number_of_years\"</span> <span class=\"o\">=&gt;</span> <span class=\"mi\">2</span>             <span class=\"p\">}</span>         <span class=\"p\">]</span>     <span class=\"p\">},</span>     <span class=\"p\">{</span>         <span class=\"s2\">\"first_name\"</span> <span class=\"o\">=&gt;</span> <span class=\"s2\">\"Bob\"</span><span class=\"p\">,</span>         <span class=\"s2\">\"cities_lived\"</span> <span class=\"o\">=&gt;</span> <span class=\"p\">[</span>             <span class=\"p\">{</span>                 <span class=\"s2\">\"place\"</span> <span class=\"o\">=&gt;</span> <span class=\"s2\">\"Seattle\"</span><span class=\"p\">,</span>                 <span class=\"s2\">\"number_of_years\"</span> <span class=\"o\">=&gt;</span> <span class=\"mi\">5</span>             <span class=\"p\">},</span>             <span class=\"p\">{</span>                 <span class=\"s2\">\"place\"</span> <span class=\"o\">=&gt;</span> <span class=\"s2\">\"Austin\"</span><span class=\"p\">,</span>                 <span class=\"s2\">\"number_of_years\"</span> <span class=\"o\">=&gt;</span> <span class=\"mi\">6</span>             <span class=\"p\">}</span>         <span class=\"p\">]</span>     <span class=\"p\">}</span> <span class=\"p\">]</span> <span class=\"n\">table</span><span class=\"p\">.</span><span class=\"nf\">insert</span> <span class=\"n\">rows</span> </code></pre> </div>  <p>There are some trade-offs involved with streaming, so be sure to read the discussion of data consistency in <a href=\"https://cloud.google.com/bigquery/streaming-data-into-bigquery\">Streaming Data Into BigQuery</a>.</p>  <h3 id=\"uploading-a-file\">Uploading a file</h3>  <p>To follow along with this example, please download the <a href=\"http://www.ssa.gov/OACT/babynames/names.zip\">names.zip</a> archive from the U.S. Social Security Administration. Inside the archive you will find over 100 files containing baby name records since the year 1880. A PDF file also contained in the archive specifies the schema used below.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">bigquery</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">bigquery</span> <span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">bigquery</span><span class=\"p\">.</span><span class=\"nf\">dataset</span> <span class=\"s2\">\"my_dataset\"</span> <span class=\"n\">table</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">create_table</span> <span class=\"s2\">\"baby_names\"</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">schema</span><span class=\"o\">|</span>   <span class=\"n\">schema</span><span class=\"p\">.</span><span class=\"nf\">string</span> <span class=\"s2\">\"name\"</span><span class=\"p\">,</span> <span class=\"ss\">mode: :required</span>   <span class=\"n\">schema</span><span class=\"p\">.</span><span class=\"nf\">string</span> <span class=\"s2\">\"sex\"</span><span class=\"p\">,</span> <span class=\"ss\">mode: :required</span>   <span class=\"n\">schema</span><span class=\"p\">.</span><span class=\"nf\">integer</span> <span class=\"s2\">\"number\"</span><span class=\"p\">,</span> <span class=\"ss\">mode: :required</span> <span class=\"k\">end</span>  <span class=\"n\">file</span> <span class=\"o\">=</span> <span class=\"no\">File</span><span class=\"p\">.</span><span class=\"nf\">open</span> <span class=\"s2\">\"names/yob2014.txt\"</span> <span class=\"n\">load_job</span> <span class=\"o\">=</span> <span class=\"n\">table</span><span class=\"p\">.</span><span class=\"nf\">load</span> <span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"ss\">format: </span><span class=\"s2\">\"csv\"</span> </code></pre> </div>  <p>Because the names data, although formatted as CSV, is distributed in files with a <code class=\"highlighter-rouge\">.txt</code> extension, this example explicitly passes the <code class=\"highlighter-rouge\">format</code> option in order to demonstrate how to handle such situations. Because CSV is the default format for load operations, the option is not actually necessary. For JSON saved with a <code class=\"highlighter-rouge\">.txt</code> extension, however, it would be.</p>  <h3 id=\"a-note-about-large-uploads\">A note about large uploads</h3>  <p>You may encounter a Broken pipe (Errno::EPIPE) error when attempting to upload large files. To avoid this problem, add the <a href=\"https://rubygems.org/gems/httpclient\">httpclient</a> gem to your project, and the line (or lines) of configuration shown below. These lines must execute after you require gcloud but before you make your first gcloud connection. The first statement configures <a href=\"https://rubygems.org/gems/faraday\">Faraday</a> to use httpclient. The second statement, which should only be added if you are using a version of Faraday at or above 0.9.2, is a workaround for <a href=\"https://github.com/GoogleCloudPlatform/gcloud-ruby/issues/367\">this gzip issue</a>.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"c1\"># Use httpclient to avoid broken pipe errors with large uploads</span> <span class=\"no\">Faraday</span><span class=\"p\">.</span><span class=\"nf\">default_adapter</span> <span class=\"o\">=</span> <span class=\"ss\">:httpclient</span>  <span class=\"c1\"># Only add the following statement if using Faraday &gt;= 0.9.2</span> <span class=\"c1\"># Override gzip middleware with no-op for httpclient</span> <span class=\"no\">Faraday</span><span class=\"o\">::</span><span class=\"no\">Response</span><span class=\"p\">.</span><span class=\"nf\">register_middleware</span> <span class=\"ss\">:gzip</span> <span class=\"o\">=&gt;</span>                                         <span class=\"no\">Faraday</span><span class=\"o\">::</span><span class=\"no\">Response</span><span class=\"o\">::</span><span class=\"no\">Middleware</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">bigquery</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">bigquery</span> </code></pre> </div>  <h2 id=\"exporting-query-results-to-google-cloud-storage\">Exporting query results to Google Cloud Storage</h2>  <p>The example below shows how to pass the <code class=\"highlighter-rouge\">table</code> option with a query in order to store results in a permanent table. It also shows how to export the result data to a Google Cloud Storage file. In order to follow along, you will need to enable the Google Cloud Storage API in addition to setting up billing.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">bigquery</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">bigquery</span> <span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">bigquery</span><span class=\"p\">.</span><span class=\"nf\">dataset</span> <span class=\"s2\">\"my_dataset\"</span> <span class=\"n\">source_table</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">table</span> <span class=\"s2\">\"baby_names\"</span> <span class=\"n\">result_table</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">create_table</span> <span class=\"s2\">\"baby_names_results\"</span>  <span class=\"n\">sql</span> <span class=\"o\">=</span> <span class=\"s2\">\"SELECT name, number as count \"</span> <span class=\"o\">+</span>       <span class=\"s2\">\"FROM baby_names \"</span> <span class=\"o\">+</span>       <span class=\"s2\">\"WHERE name CONTAINS 'Sam' \"</span> <span class=\"o\">+</span>       <span class=\"s2\">\"ORDER BY count DESC\"</span> <span class=\"n\">query_job</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">query_job</span> <span class=\"n\">sql</span><span class=\"p\">,</span> <span class=\"ss\">table: </span><span class=\"n\">result_table</span>  <span class=\"n\">query_job</span><span class=\"p\">.</span><span class=\"nf\">wait_until_done!</span>  <span class=\"k\">if</span> <span class=\"o\">!</span><span class=\"n\">query_job</span><span class=\"p\">.</span><span class=\"nf\">failed?</span>    <span class=\"n\">storage</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">storage</span>   <span class=\"n\">bucket_id</span> <span class=\"o\">=</span> <span class=\"s2\">\"bigquery-exports-</span><span class=\"si\">#{</span><span class=\"no\">SecureRandom</span><span class=\"p\">.</span><span class=\"nf\">uuid</span><span class=\"si\">}</span><span class=\"s2\">\"</span>   <span class=\"n\">bucket</span> <span class=\"o\">=</span> <span class=\"n\">storage</span><span class=\"p\">.</span><span class=\"nf\">create_bucket</span> <span class=\"n\">bucket_id</span>   <span class=\"n\">extract_url</span> <span class=\"o\">=</span> <span class=\"s2\">\"gs://</span><span class=\"si\">#{</span><span class=\"n\">bucket</span><span class=\"p\">.</span><span class=\"nf\">id</span><span class=\"si\">}</span><span class=\"s2\">/baby-names-sam.csv\"</span>    <span class=\"n\">extract_job</span> <span class=\"o\">=</span> <span class=\"n\">result_table</span><span class=\"p\">.</span><span class=\"nf\">extract</span> <span class=\"n\">extract_url</span>    <span class=\"n\">extract_job</span><span class=\"p\">.</span><span class=\"nf\">wait_until_done!</span>    <span class=\"c1\"># Download to local filesystem</span>   <span class=\"n\">bucket</span><span class=\"p\">.</span><span class=\"nf\">files</span><span class=\"p\">.</span><span class=\"nf\">first</span><span class=\"p\">.</span><span class=\"nf\">download</span> <span class=\"s2\">\"baby-names-sam.csv\"</span>  <span class=\"k\">end</span> </code></pre> </div>  <p>If a table you wish to export contains a large amount of data, you can pass a wildcard URI to export to multiple files (for sharding), or an array of URIs (for partitioning), or both. See <a href=\"https://cloud.google.com/bigquery/exporting-data-from-bigquery\">Exporting Data From BigQuery</a> for details.</p>","source":"lib/gcloud/bigquery.rb#L384","resources":[],"examples":[]},"methods":[]}