{"id":"pubsub","metadata":{"name":"Pubsub","description":"<h1 id=\"google-cloud-pubsub\">Google Cloud Pub/Sub</h1>  <p>Google Cloud Pub/Sub is designed to provide reliable, many-to-many, asynchronous messaging between applications. Publisher applications can send messages to a “topic” and other applications can subscribe to that topic to receive the messages. By decoupling senders and receivers, Google Cloud Pub/Sub allows developers to communicate between independently written applications.</p>  <p>Gcloud’s goal is to provide a API that is familiar and comfortable to Rubyists. Authentication is handled by Gcloud#pubsub. You can provide the project and credential information to connect to the Pub/Sub service, or if you are running on Google Compute Engine this configuration is taken care of for you.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"n\">topic</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">topic</span> <span class=\"s2\">\"my-topic\"</span> <span class=\"n\">topic</span><span class=\"p\">.</span><span class=\"nf\">publish</span> <span class=\"s2\">\"task completed\"</span> </code></pre> </div>  <p>To learn more about Pub/Sub, read the <a href=\"https://cloud.google.com/pubsub/overview\">Google Cloud Pub/Sub Overview </a>.</p>  <h2 id=\"retrieving-topics\">Retrieving Topics</h2>  <p>A Topic is a named resource to which messages are sent by publishers. A Topic is found by its name. (See Project#topic)</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span> <span class=\"n\">topic</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">topic</span> <span class=\"s2\">\"my-topic\"</span> </code></pre> </div>  <h2 id=\"creating-a-topic\">Creating a Topic</h2>  <p>A Topic is created from a Project. (See Project#create_topic)</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span> <span class=\"n\">topic</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">create_topic</span> <span class=\"s2\">\"my-topic\"</span> </code></pre> </div>  <h2 id=\"retrieving-subscriptions\">Retrieving Subscriptions</h2>  <p>A Subscription is a named resource representing the stream of messages from a single, specific Topic, to be delivered to the subscribing application. A Subscription is found by its name. (See Topic#subscription)</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"n\">topic</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">topic</span> <span class=\"s2\">\"my-topic\"</span> <span class=\"n\">subscription</span> <span class=\"o\">=</span> <span class=\"n\">topic</span><span class=\"p\">.</span><span class=\"nf\">subscription</span> <span class=\"s2\">\"my-topic-subscription\"</span> <span class=\"nb\">puts</span> <span class=\"n\">subscription</span><span class=\"p\">.</span><span class=\"nf\">name</span> </code></pre> </div>  <h2 id=\"creating-a-subscription\">Creating a Subscription</h2>  <p>A Subscription is created from a Topic. (See Topic#subscribe and Project#subscribe)</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"n\">topic</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">topic</span> <span class=\"s2\">\"my-topic\"</span> <span class=\"nb\">sub</span> <span class=\"o\">=</span> <span class=\"n\">topic</span><span class=\"p\">.</span><span class=\"nf\">subscribe</span> <span class=\"s2\">\"my-topic-sub\"</span> <span class=\"nb\">puts</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">name</span> <span class=\"c1\"># =&gt; \"my-topic-sub\"</span> </code></pre> </div>  <p>The subscription can be created that specifies the number of seconds to wait to be acknowledged as well as an endpoint URL to push the messages to:</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"n\">topic</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">topic</span> <span class=\"s2\">\"my-topic\"</span> <span class=\"nb\">sub</span> <span class=\"o\">=</span> <span class=\"n\">topic</span><span class=\"p\">.</span><span class=\"nf\">subscribe</span> <span class=\"s2\">\"my-topic-sub\"</span><span class=\"p\">,</span>                       <span class=\"ss\">deadline: </span><span class=\"mi\">120</span><span class=\"p\">,</span>                       <span class=\"ss\">endpoint: </span><span class=\"s2\">\"https://example.com/push\"</span> </code></pre> </div>  <h2 id=\"publishing-messages\">Publishing Messages</h2>  <p>Messages are published to a topic. Any message published to a topic without a subscription will be lost. Ensure the topic has a subscription before publishing. (See Topic#publish and Project#publish)</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"n\">topic</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">topic</span> <span class=\"s2\">\"my-topic\"</span> <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">topic</span><span class=\"p\">.</span><span class=\"nf\">publish</span> <span class=\"s2\">\"new-message\"</span> </code></pre> </div>  <p>Messages can also be published with attributes:</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"n\">topic</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">topic</span> <span class=\"s2\">\"my-topic\"</span> <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">topic</span><span class=\"p\">.</span><span class=\"nf\">publish</span> <span class=\"s2\">\"new-message\"</span><span class=\"p\">,</span>                     <span class=\"ss\">foo: :bar</span><span class=\"p\">,</span>                     <span class=\"ss\">this: :that</span> </code></pre> </div>  <p>Multiple messages can be published at the same time by passing a block:</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"n\">topic</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">topic</span> <span class=\"s2\">\"my-topic\"</span> <span class=\"n\">msgs</span> <span class=\"o\">=</span> <span class=\"n\">topic</span><span class=\"p\">.</span><span class=\"nf\">publish</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">batch</span><span class=\"o\">|</span>   <span class=\"n\">batch</span><span class=\"p\">.</span><span class=\"nf\">publish</span> <span class=\"s2\">\"new-message-1\"</span><span class=\"p\">,</span> <span class=\"ss\">foo: :bar</span>   <span class=\"n\">batch</span><span class=\"p\">.</span><span class=\"nf\">publish</span> <span class=\"s2\">\"new-message-2\"</span><span class=\"p\">,</span> <span class=\"ss\">foo: :baz</span>   <span class=\"n\">batch</span><span class=\"p\">.</span><span class=\"nf\">publish</span> <span class=\"s2\">\"new-message-3\"</span><span class=\"p\">,</span> <span class=\"ss\">foo: :bif</span> <span class=\"k\">end</span> </code></pre> </div>  <h2 id=\"pulling-messages\">Pulling Messages</h2>  <p>Messages are pulled from a Subscription. (See Subscription#pull)</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"nb\">sub</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">subscription</span> <span class=\"s2\">\"my-topic-sub\"</span> <span class=\"n\">msgs</span> <span class=\"o\">=</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">pull</span> </code></pre> </div>  <p>A maximum number of messages returned can also be specified:</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"nb\">sub</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">subscription</span> <span class=\"s2\">\"my-topic-sub\"</span><span class=\"p\">,</span> <span class=\"ss\">max: </span><span class=\"mi\">10</span> <span class=\"n\">msgs</span> <span class=\"o\">=</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">pull</span> </code></pre> </div>  <p>The request for messages can also block until messages are available. (See Subscription#wait_for_messages)</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"nb\">sub</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">subscription</span> <span class=\"s2\">\"my-topic-sub\"</span> <span class=\"n\">msgs</span> <span class=\"o\">=</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">wait_for_messages</span> </code></pre> </div>  <h2 id=\"acknowledging-a-message\">Acknowledging a Message</h2>  <p>Messages that are received can be acknowledged in Pub/Sub, marking the message to be removed so it cannot be pulled again.</p>  <p>A Message that can be acknowledged is called a ReceivedMessage. ReceivedMessages can be acknowledged one at a time: (See ReceivedMessage#acknowledge!)</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"nb\">sub</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">subscription</span> <span class=\"s2\">\"my-topic-sub\"</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">pull</span><span class=\"p\">.</span><span class=\"nf\">each</span> <span class=\"p\">{</span> <span class=\"o\">|</span><span class=\"n\">msg</span><span class=\"o\">|</span> <span class=\"n\">msg</span><span class=\"p\">.</span><span class=\"nf\">acknowledge!</span> <span class=\"p\">}</span> </code></pre> </div>  <p>Or, multiple messages can be acknowledged in a single API call: (See Subscription#acknowledge)</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"nb\">sub</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">subscription</span> <span class=\"s2\">\"my-topic-sub\"</span> <span class=\"n\">received_messages</span> <span class=\"o\">=</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">pull</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">acknowledge</span> <span class=\"n\">received_messages</span> </code></pre> </div>  <h2 id=\"modifying-a-deadline\">Modifying a Deadline</h2>  <p>A message must be acknowledged after it is pulled, or Pub/Sub will mark the message for redelivery. The message acknowledgement deadline can delayed if more time is needed. This will allow more time to process the message before the message is marked for redelivery. (See ReceivedMessage#delay!)</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"nb\">sub</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">subscription</span> <span class=\"s2\">\"my-topic-sub\"</span> <span class=\"n\">received_message</span> <span class=\"o\">=</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">pull</span><span class=\"p\">.</span><span class=\"nf\">first</span> <span class=\"k\">if</span> <span class=\"n\">received_message</span>   <span class=\"nb\">puts</span> <span class=\"n\">received_message</span><span class=\"p\">.</span><span class=\"nf\">message</span><span class=\"p\">.</span><span class=\"nf\">data</span>   <span class=\"c1\"># Delay for 2 minutes</span>   <span class=\"n\">received_message</span><span class=\"p\">.</span><span class=\"nf\">delay!</span> <span class=\"mi\">120</span> <span class=\"k\">end</span> </code></pre> </div>  <p>The message can also be made available for immediate redelivery:</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"nb\">sub</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">subscription</span> <span class=\"s2\">\"my-topic-sub\"</span> <span class=\"n\">received_message</span> <span class=\"o\">=</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">pull</span><span class=\"p\">.</span><span class=\"nf\">first</span> <span class=\"k\">if</span> <span class=\"n\">received_message</span>   <span class=\"nb\">puts</span> <span class=\"n\">received_message</span><span class=\"p\">.</span><span class=\"nf\">message</span><span class=\"p\">.</span><span class=\"nf\">data</span>   <span class=\"c1\"># Mark for redelivery by setting the deadline to now</span>   <span class=\"n\">received_message</span><span class=\"p\">.</span><span class=\"nf\">delay!</span> <span class=\"mi\">0</span> <span class=\"k\">end</span> </code></pre> </div>  <p>Multiple messages can be delayed or made available for immediate redelivery: (See Subscription#delay)</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"nb\">sub</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">subscription</span> <span class=\"s2\">\"my-topic-sub\"</span> <span class=\"n\">received_messages</span> <span class=\"o\">=</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">pull</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">delay</span> <span class=\"mi\">120</span><span class=\"p\">,</span> <span class=\"n\">received_messages</span> </code></pre> </div>  <h2 id=\"listening-for-messages\">Listening for Messages</h2>  <p>Long running workers are easy to create with <code class=\"highlighter-rouge\">listen</code>, which runs an infinitely blocking loop to process messages as they are received. (See Subscription#listen)</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"nb\">sub</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">subscription</span> <span class=\"s2\">\"my-topic-sub\"</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">listen</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">msg</span><span class=\"o\">|</span>   <span class=\"c1\"># process msg</span> <span class=\"k\">end</span> </code></pre> </div>  <p>Messages are retrieved in batches for efficiency. The number of messages pulled per batch can be limited with the <code class=\"highlighter-rouge\">max</code> option:</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"nb\">sub</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">subscription</span> <span class=\"s2\">\"my-topic-sub\"</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">listen</span> <span class=\"ss\">max: </span><span class=\"mi\">20</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">msg</span><span class=\"o\">|</span>   <span class=\"c1\"># process msg</span> <span class=\"k\">end</span> </code></pre> </div>  <p>When processing time and the acknowledgement deadline are a concern, messages can be automatically acknowledged as they are pulled with the <code class=\"highlighter-rouge\">autoack</code> option:</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"nb\">sub</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">subscription</span> <span class=\"s2\">\"my-topic-sub\"</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">listen</span> <span class=\"ss\">autoack: </span><span class=\"kp\">true</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">msg</span><span class=\"o\">|</span>   <span class=\"c1\"># process msg</span> <span class=\"k\">end</span> </code></pre> </div>  <h2 id=\"working-across-projects\">Working Across Projects</h2>  <p>All calls to the Pub/Sub service use the same project and credentials provided to the Gcloud#pubsub method. However, it is common to reference topics or subscriptions in other projects, which can be achieved by using the <code class=\"highlighter-rouge\">project</code> option. The main credentials must have permissions to the topics and subscriptions in other projects.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"c1\"># my-project-id</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"c1\"># Get a topic in the current project</span> <span class=\"n\">my_topic</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">topic</span> <span class=\"s2\">\"my-topic\"</span> <span class=\"n\">my_topic</span><span class=\"p\">.</span><span class=\"nf\">name</span> <span class=\"c1\">#=&gt; \"projects/my-project-id/topics/my-topic\"</span> <span class=\"c1\"># Get a topic in another project</span> <span class=\"n\">other_topic</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">topic</span> <span class=\"s2\">\"other-topic\"</span><span class=\"p\">,</span> <span class=\"ss\">project: </span><span class=\"s2\">\"other-project-id\"</span> <span class=\"n\">other_topic</span><span class=\"p\">.</span><span class=\"nf\">name</span> <span class=\"c1\">#=&gt; \"projects/other-project-id/topics/other-topic\"</span> </code></pre> </div>  <p>It is possible to create a subscription in the current project that pulls from a topic in another project:</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"c1\"># my-project-id</span> <span class=\"n\">pubsub</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">pubsub</span>  <span class=\"c1\"># Get a topic in another project</span> <span class=\"n\">topic</span> <span class=\"o\">=</span> <span class=\"n\">pubsub</span><span class=\"p\">.</span><span class=\"nf\">topic</span> <span class=\"s2\">\"other-topic\"</span><span class=\"p\">,</span> <span class=\"ss\">project: </span><span class=\"s2\">\"other-project-id\"</span> <span class=\"c1\"># Create a subscription in the current project that pulls from</span> <span class=\"c1\"># the topic in another project</span> <span class=\"nb\">sub</span> <span class=\"o\">=</span> <span class=\"n\">topic</span><span class=\"p\">.</span><span class=\"nf\">subscribe</span> <span class=\"s2\">\"my-sub\"</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">name</span> <span class=\"c1\">#=&gt; \"projects/my-project-id/subscriptions/my-sub\"</span> <span class=\"nb\">sub</span><span class=\"p\">.</span><span class=\"nf\">topic</span><span class=\"p\">.</span><span class=\"nf\">name</span> <span class=\"c1\">#=&gt; \"projects/other-project-id/topics/other-topic\"</span> </code></pre> </div>","source":"lib/gcloud/pubsub.rb#L419","resources":[],"examples":[]},"methods":[]}