{"id":"search","metadata":{"name":"Search","title":["Gcloud","Search"],"description":"<h1 id=\"google-cloud-search\">Google Cloud Search</h1>\n\n<p>Google Cloud Search allows an application to quickly perform full-text and\ngeo-spatial searches without having to spin up instances and without the\nhassle of managing and maintaining a search service.</p>\n\n<p>Cloud Search provides a model for indexing documents containing structured\ndata, with documents and indexes saved to a separate persistent store\noptimized for search operations. The API supports full text matching on\nstring fields and allows indexing any number of documents in any number of\nindexes.</p>\n\n<p>The Cloud Search API is an Alpha release, and might be changed in\nbackward-incompatible ways. It is not currently recommended for production\nuse. It is not subject to any SLA or deprecation policy.</p>\n\n<h2 id=\"accessing-the-service\">Accessing the Service</h2>\n\n<p>Currently, the Cloud Search API is available only to white-listed users.\nContact your account manager or a member of the Google Cloud sales team if\nyou are interested in access.</p>\n\n<h2 id=\"authentication\">Authentication</h2>\n\n<p>Authentication is handled by Gcloud#search. You can provide the project and\ncredential information to connect to the Cloud Search service, or if you are\nrunning on Google Compute Engine this configuration is taken care of for\nyou. You can read more about the options for connecting in the\n<a href=\"../AUTHENTICATION\">Authentication Guide</a>.</p>\n\n<h2 id=\"managing-indexes\">Managing Indexes</h2>\n\n<p>An Index is a searchable collection of documents that belongs to a Project.</p>\n\n<p>You can list the indexes in your current project:</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">search</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">search</span>\n\n<span class=\"n\">indexes</span> <span class=\"o\">=</span> <span class=\"n\">search</span><span class=\"p\">.</span><span class=\"nf\">indexes</span>  <span class=\"c1\"># API call</span>\n<span class=\"n\">indexes</span><span class=\"p\">.</span><span class=\"nf\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">index</span><span class=\"o\">|</span>\n  <span class=\"nb\">puts</span> <span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">index_id</span>\n<span class=\"k\">end</span>\n</code></pre>\n</div>\n\n<p>And you can use the project to create new indexes:</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">search</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">search</span>\n\n<span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">search</span><span class=\"p\">.</span><span class=\"nf\">index</span> <span class=\"s2\">\"products\"</span><span class=\"p\">,</span> <span class=\"ss\">skip_lookup: </span><span class=\"kp\">true</span>\n</code></pre>\n</div>\n\n<p>A new index is an unsaved value object. Indexes cannot be created,\nupdated, or deleted directly in the service: They are derived from the\ndocuments which are created “within” them. A new index will exist in the\nservice once you save a document that references it.</p>\n\n<h2 id=\"managing-documents\">Managing Documents</h2>\n\n<p>Using an index, create a new, unsaved Document instance, providing\nyour own unique document ID, as shown below, or omitting this argument to\nlet the service assign the ID.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">search</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">search</span>\n\n<span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">search</span><span class=\"p\">.</span><span class=\"nf\">index</span> <span class=\"s2\">\"products\"</span>\n<span class=\"n\">document</span> <span class=\"o\">=</span> <span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">document</span> <span class=\"s2\">\"product-sku-000001\"</span>\n<span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">find</span> <span class=\"n\">document</span> <span class=\"c1\"># API call</span>\n<span class=\"c1\">#=&gt; nil</span>\n<span class=\"n\">document</span><span class=\"p\">.</span><span class=\"nf\">rank</span> <span class=\"c1\">#=&gt; nil</span>\n</code></pre>\n</div>\n\n<p>Add one or more fields to the document. (See <a href=\"#module-Gcloud::Search-label-Adding`document`fields\">Adding document fields</a>, below.)</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"n\">document</span><span class=\"p\">.</span><span class=\"nf\">add</span> <span class=\"s2\">\"price\"</span><span class=\"p\">,</span> <span class=\"mi\">24</span><span class=\"o\">.</span><span class=\"mi\">95</span>\n</code></pre>\n</div>\n\n<p>When your document is complete, save it:</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">save</span> <span class=\"n\">document</span> <span class=\"c1\"># API call</span>\n<span class=\"n\">document</span><span class=\"p\">.</span><span class=\"nf\">rank</span> <span class=\"c1\"># set by the server</span>\n<span class=\"c1\">#=&gt; 1443648166</span>\n</code></pre>\n</div>\n\n<p>You can list the documents in an index:</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">search</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">search</span>\n<span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">search</span><span class=\"p\">.</span><span class=\"nf\">index</span> <span class=\"s2\">\"products\"</span>\n\n<span class=\"n\">documents</span> <span class=\"o\">=</span> <span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">documents</span> <span class=\"c1\"># API call</span>\n<span class=\"n\">documents</span><span class=\"p\">.</span><span class=\"nf\">map</span> <span class=\"o\">&amp;</span><span class=\"ss\">:doc_id</span> <span class=\"c1\">#=&gt; [\"product-sku-000001\"]</span>\n</code></pre>\n</div>\n\n<p>And you can delete documents:</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">search</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">search</span>\n<span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">search</span><span class=\"p\">.</span><span class=\"nf\">index</span> <span class=\"s2\">\"products\"</span>\n\n<span class=\"n\">document</span> <span class=\"o\">=</span> <span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">find</span> <span class=\"s2\">\"product-sku-000001\"</span>\n\n<span class=\"n\">document</span><span class=\"p\">.</span><span class=\"nf\">delete</span>  <span class=\"c1\"># API call</span>\n<span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">find</span> <span class=\"n\">document</span> <span class=\"c1\"># API call</span>\n<span class=\"c1\">#=&gt; nil</span>\n</code></pre>\n</div>\n\n<p>To update a document after manipulating its fields or rank, just re-save it:</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">search</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">search</span>\n<span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">search</span><span class=\"p\">.</span><span class=\"nf\">index</span> <span class=\"s2\">\"products\"</span>\n\n<span class=\"n\">document</span> <span class=\"o\">=</span> <span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">find</span> <span class=\"s2\">\"product-sku-000001\"</span>\n\n<span class=\"n\">document</span><span class=\"p\">.</span><span class=\"nf\">rank</span> <span class=\"o\">=</span> <span class=\"mi\">12345</span>\n<span class=\"n\">document</span><span class=\"p\">.</span><span class=\"nf\">add</span> <span class=\"s2\">\"price\"</span><span class=\"p\">,</span> <span class=\"mi\">9</span><span class=\"o\">.</span><span class=\"mi\">95</span> <span class=\"c1\"># replace existing number value</span>\n<span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">save</span> <span class=\"n\">document</span> <span class=\"c1\"># API call</span>\n</code></pre>\n</div>\n\n<h2 id=\"adding-document-fields\">Adding document fields</h2>\n\n<p>Fields belong to documents and are the data that actually gets searched.\nEach field has a FieldValues collection, which facilitates access to\nFieldValue objects. Each FieldValue object will be saved as one of the\n<a href=\"https://cloud.google.com/search/documents_indexes#document_fields_field_names_and_multi-valued_fields\">Cloud Search types</a>.\nThe type will be inferred from the value when possible, or you can\nexplicitly specify it by passing a symbol with the <code class=\"highlighter-rouge\">type</code> option to\nDocument#add.</p>\n\n<ul>\n  <li>String (<code class=\"highlighter-rouge\">:atom</code>, <code class=\"highlighter-rouge\">:html</code>, <code class=\"highlighter-rouge\">:text</code>, or <code class=\"highlighter-rouge\">:default</code>)</li>\n  <li>Number (<code class=\"highlighter-rouge\">:number</code>)</li>\n  <li>Timestamp (<code class=\"highlighter-rouge\">:datetime</code>)</li>\n  <li>Geovalue (<code class=\"highlighter-rouge\">:geo</code>)</li>\n</ul>\n\n<p>String values can be tokenized using one of three different types of\ntokenization, which can be passed with the <code class=\"highlighter-rouge\">type</code> option when the value is\nadded:</p>\n\n<ul>\n  <li>\n    <p><code class=\"highlighter-rouge\">:atom</code> means “don’t tokenize this string”, treat it as one\nthing to compare against</p>\n  </li>\n  <li>\n    <p><code class=\"highlighter-rouge\">:html</code> means “treat this string as HTML”, not comparing against the\ntags, and treating the rest of the content like <code class=\"highlighter-rouge\">:text</code></p>\n  </li>\n  <li>\n    <p><code class=\"highlighter-rouge\">:text</code> means “treat this string as normal text” and split words\napart to be compared against</p>\n  </li>\n</ul>\n\n<p>Again, you can add more than one value to a field, and the values may be of\ndifferent types.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">search</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">search</span>\n\n<span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">search</span><span class=\"p\">.</span><span class=\"nf\">index</span> <span class=\"s2\">\"products\"</span>\n<span class=\"n\">document</span> <span class=\"o\">=</span> <span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">find</span> <span class=\"s2\">\"product-sku-000001\"</span>\n<span class=\"n\">document</span><span class=\"p\">.</span><span class=\"nf\">add</span> <span class=\"s2\">\"description\"</span><span class=\"p\">,</span> <span class=\"s2\">\"The best T-shirt ever.\"</span><span class=\"p\">,</span> <span class=\"ss\">type: :text</span><span class=\"p\">,</span> <span class=\"ss\">lang: </span><span class=\"s2\">\"en\"</span>\n<span class=\"n\">document</span><span class=\"p\">.</span><span class=\"nf\">add</span> <span class=\"s2\">\"description\"</span><span class=\"p\">,</span> <span class=\"s2\">\"&lt;p&gt;The best T-shirt ever.&lt;/p&gt;\"</span><span class=\"p\">,</span> <span class=\"ss\">type: :html</span><span class=\"p\">,</span> <span class=\"ss\">lang: </span><span class=\"s2\">\"en\"</span>\n<span class=\"n\">document</span><span class=\"p\">[</span><span class=\"s2\">\"description\"</span><span class=\"p\">].</span><span class=\"nf\">size</span> <span class=\"c1\">#=&gt; 2</span>\n</code></pre>\n</div>\n\n<h2 id=\"searching\">Searching</h2>\n\n<p>After populating an index with documents, you can request search results\nwith a query:</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">search</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">search</span>\n<span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">search</span><span class=\"p\">.</span><span class=\"nf\">index</span> <span class=\"s2\">\"books\"</span>\n\n<span class=\"n\">results</span> <span class=\"o\">=</span> <span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">search</span> <span class=\"s2\">\"dark stormy\"</span>\n<span class=\"n\">results</span><span class=\"p\">.</span><span class=\"nf\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">result</span><span class=\"o\">|</span>\n  <span class=\"nb\">puts</span> <span class=\"n\">result</span><span class=\"p\">.</span><span class=\"nf\">doc_id</span>\n<span class=\"k\">end</span>\n</code></pre>\n</div>\n\n<p>By default, Result objects are sorted by document rank. For more information\nsee the <a href=\"https://cloud.google.com/search/reference/rest/v1/projects/indexes/documents#resource_representation.google.cloudsearch.v1.Document.rank\">REST API documentation for Document.rank</a>.</p>\n\n<p>You can specify how to sort results with the <code class=\"highlighter-rouge\">order</code> option:</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">search</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">search</span>\n<span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">search</span><span class=\"p\">.</span><span class=\"nf\">index</span> <span class=\"s2\">\"books\"</span>\n\n<span class=\"n\">results</span> <span class=\"o\">=</span> <span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">search</span> <span class=\"s2\">\"dark stormy\"</span><span class=\"p\">,</span> <span class=\"ss\">order: </span><span class=\"s2\">\"published, avg_review desc\"</span>\n<span class=\"n\">documents</span> <span class=\"o\">=</span> <span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">search</span> <span class=\"n\">query</span> <span class=\"c1\"># API call</span>\n</code></pre>\n</div>\n\n<p>You can add computed fields with the <code class=\"highlighter-rouge\">expressions</code> option, and specify the\nfields that are returned with the <code class=\"highlighter-rouge\">fields</code> option. No document data will be\nreturned if you omit the <code class=\"highlighter-rouge\">fields</code> option, only <code class=\"highlighter-rouge\">doc_id</code> references to any\nmatched documents.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">search</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">search</span>\n<span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">search</span><span class=\"p\">.</span><span class=\"nf\">index</span> <span class=\"s2\">\"products\"</span>\n\n<span class=\"n\">results</span> <span class=\"o\">=</span> <span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">search</span> <span class=\"s2\">\"cotton T-shirt\"</span><span class=\"p\">,</span>\n                       <span class=\"ss\">expressions: </span><span class=\"p\">{</span> <span class=\"ss\">total_price: </span><span class=\"s2\">\"(price + tax)\"</span> <span class=\"p\">},</span>\n                       <span class=\"ss\">fields: </span><span class=\"p\">[</span><span class=\"s2\">\"name\"</span><span class=\"p\">,</span> <span class=\"s2\">\"total_price\"</span><span class=\"p\">,</span> <span class=\"s2\">\"highlight\"</span><span class=\"p\">]</span>\n</code></pre>\n</div>\n\n<p>Just as in documents, Result data is accessible via Fields methods:</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">search</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">search</span>\n<span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">search</span><span class=\"p\">.</span><span class=\"nf\">index</span> <span class=\"s2\">\"products\"</span>\n<span class=\"n\">document</span> <span class=\"o\">=</span> <span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">find</span> <span class=\"s2\">\"product-sku-000001\"</span>\n<span class=\"n\">results</span> <span class=\"o\">=</span> <span class=\"n\">index</span><span class=\"p\">.</span><span class=\"nf\">search</span> <span class=\"s2\">\"cotton T-shirt\"</span>\n<span class=\"n\">values</span> <span class=\"o\">=</span> <span class=\"n\">results</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">][</span><span class=\"s2\">\"description\"</span><span class=\"p\">]</span>\n\n<span class=\"n\">values</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"c1\">#=&gt; \"100% organic cotton ruby gem T-shirt\"</span>\n<span class=\"n\">values</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"nf\">type</span> <span class=\"c1\">#=&gt; :text</span>\n<span class=\"n\">values</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"nf\">lang</span> <span class=\"c1\">#=&gt; \"en\"</span>\n<span class=\"n\">values</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"c1\">#=&gt; \"&lt;p&gt;100% organic cotton ruby gem T-shirt&lt;/p&gt;\"</span>\n<span class=\"n\">values</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">].</span><span class=\"nf\">type</span> <span class=\"c1\">#=&gt; :html</span>\n<span class=\"n\">values</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">].</span><span class=\"nf\">lang</span> <span class=\"c1\">#=&gt; \"en\"</span>\n</code></pre>\n</div>","source":"lib/gcloud/search.rb#L311","resources":[],"examples":[]},"methods":[]}