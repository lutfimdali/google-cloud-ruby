{"id":"gcloud/datastore/transaction","name":"Transaction","title":["Gcloud","Datastore","Transaction"],"description":"<h1 id=\"transaction\">Transaction</h1>\n\n<p>Special Connection instance for running transactions.</p>\n\n<p>See <a data-custom-type=\"gcloud/datastore/dataset\" data-method=\"transaction-instance\">Gcloud::Datastore::Dataset#transaction</a></p>","source":"lib/gcloud/datastore/transaction.rb#L24","resources":[],"examples":[],"methods":[{"id":"id-instance","type":"instance","name":"id","title":["Gcloud","Datastore","Transaction#id"],"description":"<p>Returns the value of attribute id</p>","source":"lib/gcloud/datastore/transaction.rb#L25","resources":[],"examples":[],"params":[],"exceptions":[],"returns":[]},{"id":"save-instance","type":"instance","name":"save","title":["Gcloud","Datastore","Transaction#save"],"description":"<p>Persist entities in a transaction.</p>","source":"lib/gcloud/datastore/transaction.rb#L46","resources":[],"examples":[{"caption":"","code":"dataset.transaction do |tx|\n  if tx.find(user.key).nil?\n    tx.save task1, task2\n  end\nend"}],"params":[],"exceptions":[],"returns":[]},{"id":"delete-instance","type":"instance","name":"delete","title":["Gcloud","Datastore","Transaction#delete"],"description":"<p>Remove entities in a transaction.</p>","source":"lib/gcloud/datastore/transaction.rb#L62","resources":[],"examples":[{"caption":"","code":"dataset.transaction do |tx|\n  if tx.find(user.key).nil?\n    tx.delete task1, task2\n  end\nend"}],"params":[],"exceptions":[],"returns":[]},{"id":"find-instance","type":"instance","name":"find","title":["Gcloud","Datastore","Transaction#find"],"description":"<p>Retrieve an entity by providing key information. The lookup is run\nwithin the transaction.</p>","source":"lib/gcloud/datastore/transaction.rb#L83","resources":[],"examples":[{"caption":"<p>Finding an entity with a key:</p>","code":"key = dataset.key \"Task\", 123456\ntask = dataset.find key"},{"caption":"<p>Finding an entity with a <code>kind</code> and <code>id</code>/<code>name</code>:</p>","code":"task = dataset.find \"Task\", 123456"}],"params":[{"name":"key_or_kind","types":["Key","String"],"description":"A Key object or <code>kind</code> string value.","optional":false,"nullable":false}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"gcloud/datastore/entity\">Gcloud::Datastore::Entity</a>","nil"],"description":""}]},{"id":"find_all-instance","type":"instance","name":"find_all","title":["Gcloud","Datastore","Transaction#find_all"],"description":"<p>Retrieve the entities for the provided keys. The lookup is run within\nthe transaction.</p>","source":"lib/gcloud/datastore/transaction.rb#L107","resources":[],"examples":[{"caption":"","code":"gcloud = Gcloud.new\ndataset = gcloud.datastore\nkey1 = dataset.key \"Task\", 123456\nkey2 = dataset.key \"Task\", 987654\ntasks = dataset.find_all key1, key2"}],"params":[{"name":"keys","types":["Key"],"description":"One or more Key objects to find records for.","optional":false,"nullable":false}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"gcloud/datastore/dataset/lookupresults\">Gcloud::Datastore::Dataset::LookupResults</a>"],"description":""}]},{"id":"run-instance","type":"instance","name":"run","title":["Gcloud","Datastore","Transaction#run"],"description":"<p>Retrieve entities specified by a Query. The query is run within the\ntransaction.</p>","source":"lib/gcloud/datastore/transaction.rb#L140","resources":[],"examples":[{"caption":"","code":"query = dataset.query(\"Task\").\n  where(\"completed\", \"=\", true)\ndataset.transaction do |tx|\n  tasks = tx.run query\nend"},{"caption":"<p>Run the query within a namespace with the <code>namespace</code> option:</p>","code":"query = Gcloud::Datastore::Query.new.kind(\"Task\").\n  where(\"completed\", \"=\", true)\ndataset.transaction do |tx|\n  tasks = tx.run query, namespace: \"ns~todo-project\"\nend"}],"params":[{"name":"query","types":["Query"],"description":"The Query object with the search criteria.","optional":false,"nullable":false},{"name":"namespace","types":["String"],"description":"The namespace the query is to run within.","optional":true,"default":"nil","nullable":true}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"gcloud/datastore/dataset/queryresults\">Gcloud::Datastore::Dataset::QueryResults</a>"],"description":""}]},{"id":"start-instance","type":"instance","name":"start","title":["Gcloud","Datastore","Transaction#start"],"description":"<p>Begins a transaction.\nThis method is run when a new Transaction is created.</p>","source":"lib/gcloud/datastore/transaction.rb#L154","resources":[],"examples":[],"params":[],"exceptions":[],"returns":[]},{"id":"commit-instance","type":"instance","name":"commit","title":["Gcloud","Datastore","Transaction#commit"],"description":"<p>Commits a transaction.</p>","source":"lib/gcloud/datastore/transaction.rb#L205","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\ndataset = gcloud.datastore\n\nuser = dataset.entity \"User\", \"heidi\" do |u|\n  u[\"name\"] = \"Heidi Henderson\"\n  u[\"email\"] = \"heidi@example.net\"\nend\n\ntx = dataset.transaction\nbegin\n  if tx.find(user.key).nil?\n    tx.save user\n  end\n  tx.commit\nrescue\n  tx.rollback\nend"},{"caption":"<p>Commit can be passed a block, same as <a data-custom-type=\"gcloud/datastore/dataset\" data-method=\"commit-instance\">Dataset#commit</a>:</p>","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\ndataset = gcloud.datastore\n\ntx = dataset.transaction\nbegin\n  tx.commit do |c|\n    c.save task1, task2\n    c.delete entity1, entity2\n  end\nrescue\n  tx.rollback\nend"}],"params":[{"name":"yield","types":["block"],"description":"an optional block for making changes","optional":true,"nullable":false},{"name":"yield.commit","types":["Commit"],"description":"The object that changes are made on","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"id":"rollback-instance","type":"instance","name":"rollback","title":["Gcloud","Datastore","Transaction#rollback"],"description":"<p>Rolls a transaction back.</p>","source":"lib/gcloud/datastore/transaction.rb#L242","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\ndataset = gcloud.datastore\n\nuser = dataset.entity \"User\", \"heidi\" do |u|\n  u[\"name\"] = \"Heidi Henderson\"\n  u[\"email\"] = \"heidi@example.net\"\nend\n\ntx = dataset.transaction\nbegin\n  if tx.find(user.key).nil?\n    tx.save user\n  end\n  tx.commit\nrescue\n  tx.rollback\nend"}],"params":[],"exceptions":[],"returns":[]},{"id":"reset!-instance","type":"instance","name":"reset!","title":["Gcloud","Datastore","Transaction#reset!"],"description":"<p>Reset the transaction.\n<a data-custom-type=\"gcloud/datastore/transaction\" data-method=\"start-instance\">Transaction#start</a> must be called afterwards.</p>","source":"lib/gcloud/datastore/transaction.rb#L254","resources":[],"examples":[],"params":[],"exceptions":[],"returns":[]}]}