{"id":"index","metadata":{"name":"Index","description":"<h1 id=\"index\">Index</h1>  <p>An index manages <a data-custom-type=\"search/document\">Document</a> instances for retrieval. Indexes cannot be created, updated, or deleted directly on the server: They are derived from the documents that reference them. You can manage groups of documents by putting them into separate indexes.</p>  <p>With an index, you can retrieve documents with <a data-custom-type=\"#find\">#find</a> and <a data-custom-type=\"#documents\">#documents</a>; manage them with <a data-custom-type=\"#document\">#document</a>, <a data-custom-type=\"#save\">#save</a>, and <a data-custom-type=\"#remove\">#remove</a>; and perform searches over their fields with <a data-custom-type=\"gcloud#search\">#search</a>.</p>","source":"lib/gcloud/search/index.rb#L49","resources":[{"title":"Documents and Indexes","link":"https://cloud.google.com/search/documents_indexes"}],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"books\"\n\nresults = index.search \"dark stormy\"\nresults.each do |result|\n  puts result.doc_id\nend"}]},"methods":[{"metadata":{"name":"index_id","description":"<p>The index identifier. May be defined by the server or by the client. Must be unique within the project. It cannot be an empty string. It must contain only visible, printable ASCII characters (ASCII codes 33 through 126 inclusive) and be no longer than 100 characters. It cannot begin with an exclamation point (<code>!</code>), and it cannot begin and end with double underscores (<code>__</code>).</p>","source":"lib/gcloud/search/index.rb#L73","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"text_fields","description":"<p>The names of fields in which TEXT values are stored.</p>","source":"lib/gcloud/search/index.rb#L81","resources":[{"title":"Index schemas","link":"https://cloud.google.com/search/documents_indexes#index_schemas"}],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"html_fields","description":"<p>The names of fields in which HTML values are stored.</p>","source":"lib/gcloud/search/index.rb#L90","resources":[{"title":"Index schemas","link":"https://cloud.google.com/search/documents_indexes#index_schemas"}],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"atom_fields","description":"<p>The names of fields in which ATOM values are stored.</p>","source":"lib/gcloud/search/index.rb#L99","resources":[{"title":"Index schemas","link":"https://cloud.google.com/search/documents_indexes#index_schemas"}],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"datetime_fields","description":"<p>The names of fields in which DATE values are stored.</p>","source":"lib/gcloud/search/index.rb#L108","resources":[{"title":"Index schemas","link":"https://cloud.google.com/search/documents_indexes#index_schemas"}],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"number_fields","description":"<p>The names of fields in which NUMBER values are stored.</p>","source":"lib/gcloud/search/index.rb#L117","resources":[{"title":"Index schemas","link":"https://cloud.google.com/search/documents_indexes#index_schemas"}],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"geo_fields","description":"<p>The names of fields in which GEO values are stored.</p>","source":"lib/gcloud/search/index.rb#L126","resources":[{"title":"Index schemas","link":"https://cloud.google.com/search/documents_indexes#index_schemas"}],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"field_names","description":"<p>The names of all the fields that are stored on the index.</p>","source":"lib/gcloud/search/index.rb#L133","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"field_types_for","description":"<p>The field value types that are stored on the field name.</p>","source":"lib/gcloud/search/index.rb#L140","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"find","description":"<p>Retrieves an existing document by id.</p>","source":"lib/gcloud/search/index.rb#L169","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"products\"\n\ndocument = index.find \"product-sku-000001\"\nputs document.doc_id"}]},"params":[{"name":"doc_id","types":["String","Gcloud::Search::Document"],"description":"The id of a document or a Document instance.","optional":false,"nullable":false}],"exceptions":[],"returns":[{"types":["Gcloud::Search::Document","nil"],"description":"Returns <code class=\"highlighter-rouge\">nil</code> if the document does not exist"}]},{"metadata":{"name":"document","description":"<p>Helper for creating a new Document instance. The returned instance is local: It is either not yet saved to the service (see <a data-custom-type=\"search/index#save\">#save</a>), or if it has been given the id of an existing document, it is not yet populated with the documentâ€™s data (see <a data-custom-type=\"search/index#find\">#find</a>).</p>","source":"lib/gcloud/search/index.rb#L227","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"products\"\n\ndocument = index.document \"product-sku-000001\"\ndocument.doc_id #=> nil\ndocument.rank #=> nil"},{"caption":"<p>To check if an index already contains a document:</p>","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"products\"\n\ndocument = index.document \"product-sku-000001\"\ndocument = index.find document # returns nil if not present"}]},"params":[{"name":"doc_id","types":["String","nil"],"description":"An optional unique ID for the new document. When the document is saved, this value must contain only visible, printable ASCII characters (ASCII codes 33 through 126 inclusive) and be no longer than 500 characters. It cannot begin with an exclamation point (<code>!</code>), and it cannot begin and end with double underscores (<code>__</code>).","optional":true,"default":"nil","nullable":true},{"name":"rank","types":["Integer","nil"],"description":"An optional rank for the new document. An integer which determines the default ordering of documents returned from a search. It is a bad idea to assign the same rank to many documents, and the same rank should never be assigned to more than 10,000 documents. By default (when it is not specified or set to 0), it is set at the time the document is saved to the number of seconds since January 1, 2011. The rank can be used in the <code class=\"highlighter-rouge\">expressions</code>, <code class=\"highlighter-rouge\">order</code>, and <code class=\"highlighter-rouge\">fields</code> options in <a data-custom-type=\"search/index#search\">#search</a>, where it should referenced as <code class=\"highlighter-rouge\">rank</code>.","optional":true,"default":"nil","nullable":true}],"exceptions":[],"returns":[{"types":["Gcloud::Search::Document"],"description":null}]},{"metadata":{"name":"documents","description":"<p>Retrieves the list of documents belonging to the index.</p>","source":"lib/gcloud/search/index.rb#L272","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"products\"\n\ndocuments = index.documents\ndocuments.each do |index|\n  puts index.index_id\nend"},{"caption":"<p>With pagination: (See <a data-custom-type=\"search/document/list\">Gcloud::Search::Document::List</a>)</p>","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"products\"\n\ndocuments = index.documents\nloop do\n  documents.each do |index|\n    puts index.index_id\n  end\n  break unless documents.next?\n  documents = documents.next\nend"}]},"params":[{"name":"token","types":["String"],"description":"A previously-returned page token representing part of the larger set of results to view.","optional":true,"default":"nil","nullable":true},{"name":"max","types":["Integer"],"description":"Maximum number of documents to return. The default is <code class=\"highlighter-rouge\">100</code>.","optional":true,"default":"nil","nullable":true}],"exceptions":[],"returns":[{"types":["Array<Gcloud::Search::Document>"],"description":"See <a data-custom-type=\"search/document/list\">Gcloud::Search::Document::List</a>)"}]},{"metadata":{"name":"save","description":"<p>Saves a new or existing document to the index. If the document instance is new and has been given an id (see <a data-custom-type=\"search/index#document\">#document</a>), it will replace an existing document in the index that has the same unique id.</p>","source":"lib/gcloud/search/index.rb#L305","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"products\"\n\ndocument = index.document \"product-sku-000001\"\ndocument.doc_id #=> nil\ndocument.rank #=> nil\n\ndocument = index.save document\ndocument.doc_id #=> \"-2486020449015432113\"\ndocument.rank #=> 154223228"}]},"params":[{"name":"document","types":["Gcloud::Search::Document"],"description":"A Document instance, either new (see <a data-custom-type=\"search/index#document\">#document</a>) or existing (see <a data-custom-type=\"search/index#find\">#find</a>).","optional":false,"nullable":false}],"exceptions":[],"returns":[{"types":["Gcloud::Search::Document"],"description":null}]},{"metadata":{"name":"remove","description":"<p>Permanently deletes the document from the index.</p>","source":"lib/gcloud/search/index.rb#L333","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"products\"\n\nindex.remove \"product-sku-000001\""}]},"params":[{"name":"doc_id","types":["String"],"description":"The id of the document.","optional":false,"nullable":false}],"exceptions":[],"returns":[{"types":["Boolean"],"description":"<code class=\"highlighter-rouge\">true</code> if successful"}]},{"metadata":{"name":"delete","description":"<p>Permanently deletes the index by deleting its documents. (Indexes cannot be created, updated, or deleted directly on the server: They are derived from the documents that reference them.)</p>","source":"lib/gcloud/search/index.rb#L367","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"books\"\nindex.delete"},{"caption":"<p>Deleting an index containing documents with the <code class=\"highlighter-rouge\">force</code> option:</p>","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"books\"\nindex.delete force: true"}]},"params":[{"name":"force","types":["Boolean"],"description":"If <code class=\"highlighter-rouge\">true</code>, ensures the deletion of the index by first deleting all documents. If <code class=\"highlighter-rouge\">false</code> and the index contains documents, the request will fail. Default is <code class=\"highlighter-rouge\">false</code>.","optional":true,"default":"false","nullable":false}],"exceptions":[],"returns":[]},{"metadata":{"name":"search","description":"<p>Runs a search against the documents in the index using the provided query.</p>  <p>By default, Result objects are sorted by document rank. For more information see the <a href=\"https://cloud.google.com/search/reference/rest/v1/projects/indexes/documents#resource_representation.google.cloudsearch.v1.Document.rank\">REST API documentation for Document.rank</a>.</p>  <p>You can specify how to sort results with the <code class=\"highlighter-rouge\">order</code> option. In the example below, the <code>-</code> character before <code class=\"highlighter-rouge\">avg_review</code> means that results will be sorted in ascending order by <code class=\"highlighter-rouge\">published</code> and then in descending order by <code class=\"highlighter-rouge\">avg_review</code>. You can add computed fields with the <code class=\"highlighter-rouge\">expressions</code> option, and limit the fields that are returned with the <code class=\"highlighter-rouge\">fields</code> option.</p>","source":"lib/gcloud/search/index.rb#L534","resources":[{"title":"The REST API documentation for indexes.search","link":"https://cloud.google.com/search/reference/rest/v1/projects/indexes/search"}],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"books\"\n\nresults = index.search \"dark stormy\"\nresults.each do |result|\n  puts result.doc_id\nend"},{"caption":"<p>With pagination: (See <a data-custom-type=\"search/result/list\">Gcloud::Search::Result::List</a>)</p>","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"books\"\n\nresults = index.results\nloop do\n  results.each do |result|\n    puts result.doc_id\n  end\n  break unless results.next?\n  results = results.next\nend"},{"caption":"<p>With the <code class=\"highlighter-rouge\">order</code> option:</p>","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"books\"\n\nresults = index.search \"dark stormy\", order: \"published, avg_review desc\"\ndocuments = index.search query # API call"},{"caption":"<p>With the <code class=\"highlighter-rouge\">fields</code> option:</p>","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"products\"\n\nresults = index.search \"cotton T-shirt\",\n                       expressions: { total_price: \"(price + tax)\" },\n                       fields: [\"name\", \"total_price\", \"highlight\"]"},{"caption":"<p>Just as in documents, data is accessible via <a data-custom-type=\"search/fields\">Fields</a> methods:</p>","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\nsearch = gcloud.search\nindex = search.index \"products\"\ndocument = index.find \"product-sku-000001\"\nresults = index.search \"cotton T-shirt\"\nvalues = results[0][\"description\"]\n\nvalues[0] #=> \"100% organic cotton ruby gem T-shirt\"\nvalues[0].type #=> :text\nvalues[0].lang #=> \"en\"\nvalues[1] #=> \"<p>100% organic cotton ruby gem T-shirt</p>\"\nvalues[1].type #=> :html\nvalues[1].lang #=> \"en\""}]},"params":[{"name":"query","types":["String"],"description":"The query string in search query syntax. If the query is <code class=\"highlighter-rouge\">nil</code> or empty, all documents are returned. For more information see <a href=\"https://cloud.google.com/search/query\">Query Strings</a>.","optional":false,"nullable":false},{"name":"expressions","types":["Hash"],"description":"Customized expressions used in <code class=\"highlighter-rouge\">order</code> or <code class=\"highlighter-rouge\">fields</code>. The expression can contain fields in Document, the built-in fields ( <code class=\"highlighter-rouge\">rank</code>, the document <code class=\"highlighter-rouge\">rank</code>, and <code class=\"highlighter-rouge\">score</code> if scoring is enabled) and fields defined in <code class=\"highlighter-rouge\">expressions</code>. All field expressions expressed as a <code class=\"highlighter-rouge\">Hash</code> with the keys as the <code class=\"highlighter-rouge\">name</code> and the values as the <code class=\"highlighter-rouge\">expression</code>. The expression value can be a combination of supported functions encoded in the string. Expressions involving number fields can use the arithmetical operators (+, -, *, /) and the built-in numeric functions (<code class=\"highlighter-rouge\">max</code>, <code class=\"highlighter-rouge\">min</code>, <code class=\"highlighter-rouge\">pow</code>, <code class=\"highlighter-rouge\">count</code>, <code class=\"highlighter-rouge\">log</code>, <code class=\"highlighter-rouge\">abs</code>). Expressions involving geopoint fields can use the <code class=\"highlighter-rouge\">geopoint</code> and <code class=\"highlighter-rouge\">distance</code> functions. Expressions for text and html fields can use the <code class=\"highlighter-rouge\">snippet</code> function.","optional":true,"default":"nil","nullable":true},{"name":"matched_count_accuracy","types":["Integer"],"description":"Minimum accuracy requirement for <a data-custom-type=\"search/result/list#matched_count\">Result::List#matched_count</a>. If specified, <code class=\"highlighter-rouge\">matched_count</code> will be accurate to at least that number. For example, when set to 100, any <code>matched_count &lt;= 100</code> is accurate. This option may add considerable latency/expense. By default (when it is not specified or set to 0), the accuracy is the same as <code class=\"highlighter-rouge\">max</code>.","optional":true,"default":"nil","nullable":true},{"name":"offset","types":["Integer"],"description":"Used to advance pagination to an arbitrary result, independent of the previous results. Offsets are an inefficient alternative to using <code class=\"highlighter-rouge\">token</code>. (Both cannot be both set.) The default is 0.","optional":true,"default":"nil","nullable":true},{"name":"order","types":["String"],"description":"A comma-separated list of fields for sorting on the search result, including fields from Document, the built-in fields (<code class=\"highlighter-rouge\">rank</code> and <code class=\"highlighter-rouge\">score</code>), and fields defined in expressions. The default sorting order is ascending. To specify descending order for a field, a suffix <code>\" desc\"</code> should be appended to the field name. For example: <code>orderBy=\"foo desc,bar\"</code>. The default value for text sort is the empty string, and the default value for numeric sort is 0. If not specified, the search results are automatically sorted by descending <code class=\"highlighter-rouge\">rank</code>. Sorting by ascending <code class=\"highlighter-rouge\">rank</code> is not allowed.","optional":true,"default":"nil","nullable":true},{"name":"fields","types":["String","Array<String>"],"description":"The fields to return in the <a data-custom-type=\"search/result\">Search::Result</a> objects. These can be fields from <a data-custom-type=\"search/document\">Document</a>, the built-in fields <code class=\"highlighter-rouge\">rank</code> and <code class=\"highlighter-rouge\">score</code>, and fields defined in expressions. The default is to return all fields.","optional":true,"default":"nil","nullable":true},{"name":"scorer","types":["String","Symbol"],"description":"The scoring function to invoke on a search result for this query. If scorer is not set, scoring is disabled and <code class=\"highlighter-rouge\">score</code> is 0 for all documents in the search result. To enable document relevancy score based on term frequency, set <code class=\"highlighter-rouge\">scorer</code> to <code class=\"highlighter-rouge\">:generic</code>.","optional":true,"default":"nil","nullable":true},{"name":"scorer_size","types":["Integer"],"description":"Maximum number of top retrieved results to score. It is valid only when <code class=\"highlighter-rouge\">scorer</code> is set. The default is 100.","optional":true,"default":"nil","nullable":true},{"name":"token","types":["String"],"description":"A previously-returned page token representing part of the larger set of results to view.","optional":true,"default":"nil","nullable":true},{"name":"max","types":["Integer"],"description":"Maximum number of results to return per page.","optional":true,"default":"nil","nullable":true}],"exceptions":[],"returns":[{"types":["Array<Gcloud::Search::Result>"],"description":"(See <a data-custom-type=\"search/result/list\">Gcloud::Search::Result::List</a>)"}]},{"metadata":{"name":"ensure_connection!","description":"<p>Raise an error unless an active connection is available.</p>","source":"lib/gcloud/search/index.rb#L557","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"format_expressions","description":"","source":"lib/gcloud/search/index.rb#L561","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]}]}