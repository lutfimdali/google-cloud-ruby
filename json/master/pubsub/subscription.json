{"id":"subscription","metadata":{"name":"Subscription","description":"<h1 id=\"subscription\">Subscription</h1>  <p>A named resource representing the stream of messages from a single, specific <a data-custom-type=\"pubsub/topic\">Topic</a>, to be delivered to the subscribing application.</p>","source":"lib/gcloud/pubsub/subscription.rb#L38","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsub = pubsub.subscription \"my-topic-sub\"\nmsgs = sub.pull\nmsgs.each { |msg| msg.acknowledge! }"}]},"methods":[{"metadata":{"name":"name","description":"<p>The name of the subscription.</p>","source":"lib/gcloud/pubsub/subscription.rb#L71","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"topic","description":"<p>The <a data-custom-type=\"pubsub/topic\">Topic</a> from which this subscription receives messages.</p>","source":"lib/gcloud/pubsub/subscription.rb#L89","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsub = pubsub.subscription \"my-topic-sub\"\nsub.topic.name #=> \"projects/my-project/topics/my-topic\""}]},"params":[],"exceptions":[],"returns":[{"types":["Topic"],"description":null}]},{"metadata":{"name":"deadline","description":"<p>This value is the maximum number of seconds after a subscriber receives a message before the subscriber should acknowledge the message.</p>","source":"lib/gcloud/pubsub/subscription.rb#L97","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"endpoint","description":"<p>Returns the URL locating the endpoint to which messages should be pushed.</p>","source":"lib/gcloud/pubsub/subscription.rb#L105","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"endpoint=","description":"<p>Sets the URL locating the endpoint to which messages should be pushed.</p>","source":"lib/gcloud/pubsub/subscription.rb#L112","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"exists?","description":"<p>Determines whether the subscription exists in the Pub/Sub service.</p>","source":"lib/gcloud/pubsub/subscription.rb#L134","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsub = pubsub.subscription \"my-topic-sub\"\nsub.exists? #=> true"}]},"params":[],"exceptions":[],"returns":[{"types":["Boolean"],"description":null}]},{"metadata":{"name":"delete","description":"<p>Deletes an existing subscription. All pending messages in the subscription are immediately dropped.</p>","source":"lib/gcloud/pubsub/subscription.rb#L178","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsub = pubsub.subscription \"my-topic-sub\"\nsub.delete"}]},"params":[],"exceptions":[],"returns":[{"types":["Boolean"],"description":"Returns <code class=\"highlighter-rouge\">true</code> if the subscription was deleted."}]},{"metadata":{"name":"pull","description":"<p>Pulls messages from the server. Returns an empty list if there are no messages available in the backlog. Raises an ApiError with status <code class=\"highlighter-rouge\">UNAVAILABLE</code> if there are too many concurrent pull requests pending for the given subscription.</p>","source":"lib/gcloud/pubsub/subscription.rb#L235","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsub = pubsub.subscription \"my-topic-sub\"\nsub.pull.each { |msg| msg.acknowledge! }"},{"caption":"<p>A maximum number of messages returned can also be specified:</p>","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsub = pubsub.subscription \"my-topic-sub\", max: 10\nsub.pull.each { |msg| msg.acknowledge! }"},{"caption":"<p>The call can block until messages are available:</p>","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsub = pubsub.subscription \"my-topic-sub\"\nmsgs = sub.pull immediate: false\nmsgs.each { |msg| msg.acknowledge! }"}]},"params":[{"name":"immediate","types":["Boolean"],"description":"When <code class=\"highlighter-rouge\">true</code> the system will respond immediately even if it is not able to return messages. When <code class=\"highlighter-rouge\">false</code> the system is allowed to wait until it can return least one message. No messages are returned when a request times out. The default value is <code class=\"highlighter-rouge\">true</code>.","optional":true,"default":"true","nullable":false},{"name":"max","types":["Integer"],"description":"The maximum number of messages to return for this request. The Pub/Sub system may return fewer than the number specified. The default value is <code class=\"highlighter-rouge\">100</code>, the maximum value is <code class=\"highlighter-rouge\">1000</code>.","optional":true,"default":"100","nullable":false},{"name":"autoack","types":["Boolean"],"description":"Automatically acknowledge the message as it is pulled. The default value is <code class=\"highlighter-rouge\">false</code>.","optional":true,"default":"false","nullable":false}],"exceptions":[],"returns":[{"types":["Array<Gcloud::Pubsub::ReceivedMessage>"],"description":null}]},{"metadata":{"name":"wait_for_messages","description":"<p>Pulls from the server while waiting for messages to become available. This is the same as:</p>  <p>subscription.pull immediate: false</p>","source":"lib/gcloud/pubsub/subscription.rb#L276","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsub = pubsub.subscription \"my-topic-sub\"\nmsgs = sub.wait_for_messages\nmsgs.each { |msg| msg.acknowledge! }"}]},"params":[{"name":"max","types":["Integer"],"description":"The maximum number of messages to return for this request. The Pub/Sub system may return fewer than the number specified. The default value is <code class=\"highlighter-rouge\">100</code>, the maximum value is <code class=\"highlighter-rouge\">1000</code>.","optional":true,"default":"100","nullable":false},{"name":"autoack","types":["Boolean"],"description":"Automatically acknowledge the message as it is pulled. The default value is <code class=\"highlighter-rouge\">false</code>.","optional":true,"default":"false","nullable":false}],"exceptions":[],"returns":[{"types":["Array<Gcloud::Pubsub::ReceivedMessage>"],"description":null}]},{"metadata":{"name":"listen","description":"<p>Poll the backend for new messages. This runs a loop to ping the API, blocking indefinitely, yielding retrieved messages as they are received.</p>","source":"lib/gcloud/pubsub/subscription.rb#L328","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsub = pubsub.subscription \"my-topic-sub\"\nsub.listen do |msg|\n  # process msg\nend"},{"caption":"<p>Limit the number of messages pulled per batch with <code class=\"highlighter-rouge\">max</code>:</p>","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsub = pubsub.subscription \"my-topic-sub\"\nsub.listen max: 20 do |msg|\n  # process msg\nend"},{"caption":"<p>Automatically acknowledge messages with <code class=\"highlighter-rouge\">autoack</code>:</p>","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsub = pubsub.subscription \"my-topic-sub\"\nsub.listen autoack: true do |msg|\n  # process msg\nend"}]},"params":[{"name":"max","types":["Integer"],"description":"The maximum number of messages to return for this request. The Pub/Sub system may return fewer than the number specified. The default value is <code class=\"highlighter-rouge\">100</code>, the maximum value is <code class=\"highlighter-rouge\">1000</code>.","optional":true,"default":"100","nullable":false},{"name":"autoack","types":["Boolean"],"description":"Automatically acknowledge the message as it is pulled. The default value is <code class=\"highlighter-rouge\">false</code>.","optional":true,"default":"false","nullable":false},{"name":"delay","types":["Number"],"description":"The number of seconds to pause between requests when the Google Cloud service has no messages to return. The default value is <code class=\"highlighter-rouge\">1</code>.","optional":true,"default":"1","nullable":false},{"name":"yield","types":["block"],"description":"a block for processing new messages","optional":true,"nullable":false},{"name":"yield.msg","types":["ReceivedMessage"],"description":"the newly received message","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"metadata":{"name":"acknowledge","description":"<p>Acknowledges receipt of a message. After an ack, the Pub/Sub system can remove the message from the subscription. Acknowledging a message whose ack deadline has expired may succeed, although the message may have been sent again. Acknowledging a message more than once will not result in an error. This is only used for messages received via pull.</p>","source":"lib/gcloud/pubsub/subscription.rb#L360","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsub = pubsub.subscription \"my-topic-sub\"\nmessages = sub.pull\nsub.acknowledge messages"}]},"params":[{"name":"*messages","types":["ReceivedMessage","String"],"description":"One or more <a data-custom-type=\"pubsub/receivedmessage\">ReceivedMessage</a> objects or ack_id values.","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"metadata":{"name":"delay","description":"<p>Modifies the acknowledge deadline for messages.</p>  <p>This indicates that more time is needed to process the messages, or to make the messages available for redelivery if the processing was interrupted.</p>","source":"lib/gcloud/pubsub/subscription.rb#L397","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsub = pubsub.subscription \"my-topic-sub\"\nmessages = sub.pull\nsub.delay 120, messages"}]},"params":[{"name":"new_deadline","types":["Integer"],"description":"The new ack deadline in seconds from the time this request is sent to the Pub/Sub system. Must be &gt;= 0. For example, if the value is <code class=\"highlighter-rouge\">10</code>, the new ack deadline will expire 10 seconds after the call is made. Specifying <code class=\"highlighter-rouge\">0</code> may immediately make the message available for another pull request.","optional":false,"nullable":false},{"name":"*messages","types":["ReceivedMessage","String"],"description":"One or more <a data-custom-type=\"pubsub/receivedmessage\">ReceivedMessage</a> objects or ack_id values.","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"metadata":{"name":"policy","description":"<p>Gets the access control policy.</p>  <p>By default, the policy values are memoized to reduce the number of API calls to the Pub/Sub service.</p>","source":"lib/gcloud/pubsub/subscription.rb#L448","resources":[],"examples":[{"caption":"<p>Policy values are memoized to reduce the number of API calls:</p>","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsubscription = pubsub.subscription \"my-subscription\"\nputs subscription.policy[\"bindings\"]\nputs subscription.policy[\"rules\"]"},{"caption":"<p>Use <code class=\"highlighter-rouge\">force</code> to retrieve the latest policy from the service:</p>","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nsubscription = pubsub.subscription \"my-subscription\"\npolicy = subscription.policy force: true"}]},"params":[{"name":"force","types":["Boolean"],"description":"Force the latest policy to be retrieved from the Pub/Sub service when <code class=\"highlighter-rouge\">true</code>. Otherwise the policy will be memoized to reduce the number of API calls made to the Pub/Sub service. The default is <code class=\"highlighter-rouge\">false</code>.","optional":true,"default":"nil","nullable":true}],"exceptions":[],"returns":[{"types":["Hash"],"description":"Returns a hash that conforms to the following structure:</p>  <p>{   “etag”=&gt;”CAE=”,   “bindings” =&gt; [{     “role” =&gt; “roles/viewer”,     “members” =&gt; [“serviceAccount:your-service-account”]   }] }"}]},{"metadata":{"name":"policy=","description":"<p>Sets the access control policy.</p>","source":"lib/gcloud/pubsub/subscription.rb#L487","resources":[],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nviewer_policy = {\n  \"bindings\" => [{\n    \"role\" => \"roles/viewer\",\n    \"members\" => [\"serviceAccount:your-service-account\"]\n  }]\n}\nsubscription = pubsub.subscription \"my-subscription\"\nsubscription.policy = viewer_policy"}]},"params":[{"name":"new_policy","types":["String"],"description":"A hash that conforms to the following structure:</p>  <p>{     “bindings” =&gt; [{       “role” =&gt; “roles/viewer”,       “members” =&gt; [“serviceAccount:your-service-account”]     }]   }","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"metadata":{"name":"test_permissions","description":"<p>Tests the specified permissions against the <a href=\"https://cloud.google.com/iam/\">Cloud IAM</a> access control policy.</p>","source":"lib/gcloud/pubsub/subscription.rb#L522","resources":[{"title":"Managing Policies","link":"https://cloud.google.com/iam/docs/managing-policies"}],"examples":[{"caption":"","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\nsub = pubsub.subscription \"my-subscription\"\nperms = sub.test_permissions \"projects.subscriptions.list\",\n                             \"projects.subscriptions.pull\"\nperms.include? \"projects.subscriptions.list\" #=> true\nperms.include? \"projects.subscriptions.pull\" #=> false"}]},"params":[{"name":"*permissions","types":["String","Array<String>"],"description":"The set of permissions to check access for. Permissions with wildcards (such as <code class=\"highlighter-rouge\">*</code> or <code class=\"highlighter-rouge\">storage.*</code>) are not allowed.","optional":false,"nullable":false}],"exceptions":[],"returns":[{"types":["Array<String>"],"description":"The permissions that have access."}]},{"metadata":{"name":"ensure_connection!","description":"<p>Raise an error unless an active connection is available.</p>","source":"lib/gcloud/pubsub/subscription.rb#L546","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"ensure_gapi!","description":"<p>Ensures a Google API object exists.</p>","source":"lib/gcloud/pubsub/subscription.rb#L552","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"coerce_ack_ids","description":"<p>Makes sure the values are the <code class=\"highlighter-rouge\">ack_id</code>. If given several <a data-custom-type=\"pubsub/receivedmessage\">ReceivedMessage</a> objects extract the <code class=\"highlighter-rouge\">ack_id</code> values.</p>","source":"lib/gcloud/pubsub/subscription.rb#L566","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]}]}