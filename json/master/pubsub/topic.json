{"id":"topic","metadata":{"name":"Topic","description":"<h1 id=\"topic\">Topic</h1>\n\n<p>A named resource to which messages are published.</p>","source":"lib/gcloud/pubsub/topic.rb#L37","resources":[],"examples":[{"caption":null,"code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\ntopic = pubsub.topic \"my-topic\"\ntopic.publish \"task completed\""}]},"methods":[{"metadata":{"name":"name","description":"<p>The name of the topic in the form of\n“/projects/project-identifier/topics/topic-name”.</p>","source":"lib/gcloud/pubsub/topic.rb#L70","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"delete","description":"<p>Permanently deletes the topic.</p>","source":"lib/gcloud/pubsub/topic.rb#L88","resources":[],"examples":[{"caption":null,"code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\ntopic = pubsub.topic \"my-topic\"\ntopic.delete"}]},"params":[],"exceptions":[],"returns":[{"types":["Boolean"],"description":"Returns <code class=\"highlighter-rouge\">true</code> if the topic was deleted."}]},{"metadata":{"name":"subscribe","description":"<p>Creates a new {Subscription} object on the current Topic.</p>","source":"lib/gcloud/pubsub/topic.rb#L147","resources":[],"examples":[{"caption":null,"code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\ntopic = pubsub.topic \"my-topic\"\nsub = topic.subscribe \"my-topic-sub\"\nputs sub.name # => \"my-topic-sub\""},{"caption":"The name is optional, and will be generated if not given:","code":"\nrequire \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\ntopic = pubsub.topic \"my-topic\"\nsub = topic.subscribe \"my-topic-sub\"\nputs sub.name # => \"generated-sub-name\""},{"caption":"Wait 2 minutes for acknowledgement and push all to an endpoint:","code":"\nrequire \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\ntopic = pubsub.topic \"my-topic\"\nsub = topic.subscribe \"my-topic-sub\",\n                      deadline: 120,\n                      endpoint: \"https://example.com/push\""}]},"params":[{"name":"subscription_name","types":["String"],"description":"Name of the new subscription. Must\nstart with a letter, and contain only letters ([A-Za-z]), numbers\n([0-9], dashes (-), underscores (_), periods (.), tildes (~), plus (+)\nor percent signs (%). It must be between 3 and 255 characters in\nlength, and it must not start with “goog”.","optional":false,"nullable":false},{"name":"deadline","types":["Integer"],"description":"The maximum number of seconds after a\nsubscriber receives a message before the subscriber should acknowledge\nthe message.","optional":true,"default":"nil","nullable":true},{"name":"endpoint","types":["String"],"description":"A URL locating the endpoint to which messages\nshould be pushed.","optional":true,"default":"nil","nullable":true}],"exceptions":[],"returns":[{"types":["Gcloud::Pubsub::Subscription"],"description":null}]},{"metadata":{"name":"subscription","description":"<p>Retrieves subscription by name.</p>","source":"lib/gcloud/pubsub/topic.rb#L192","resources":[],"examples":[{"caption":null,"code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\ntopic = pubsub.topic \"my-topic\"\nsubscription = topic.subscription \"my-topic-subscription\"\nputs subscription.name"},{"caption":"Skip the lookup against the service with <code class=\"highlighter-rouge\">skip_lookup</code>:","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\n# No API call is made to retrieve the subscription information.\nsubscription = pubsub.subscription \"my-sub\", skip_lookup: true\nputs subscription.name"}]},"params":[{"name":"subscription_name","types":["String"],"description":"Name of a subscription.","optional":false,"nullable":false},{"name":"skip_lookup","types":["Boolean"],"description":"Optionally create a {Subscription} object\nwithout verifying the subscription resource exists on the Pub/Sub\nservice. Calls made on this object will raise errors if the service\nresource does not exist. Default is <code class=\"highlighter-rouge\">false</code>.","optional":true,"default":"nil","nullable":true}],"exceptions":[],"returns":[{"types":["Gcloud::Pubsub::Subscription","nil"],"description":"Returns <code class=\"highlighter-rouge\">nil</code> if\nthe subscription does not exist."}]},{"metadata":{"name":"subscriptions","description":"<p>Retrieves a list of subscription names for the given project.</p>","source":"lib/gcloud/pubsub/topic.rb#L247","resources":[],"examples":[{"caption":null,"code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\ntopic = pubsub.topic \"my-topic\"\nsubscription = topic.subscriptions\nsubscriptions.each do |subscription|\n  puts subscription.name\nend"},{"caption":"With pagination: (See {Subscription::List#token})","code":"\nrequire \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\ntopic = pubsub.topic \"my-topic\"\nall_subs = []\ntmp_subs = topic.subscriptions\nwhile tmp_subs.any? do\n  tmp_subs.each do |subscription|\n    all_subs << subscription\n  end\n  # break loop if no more subscriptions available\n  break if tmp_subs.token.nil?\n  # get the next group of subscriptions\n  tmp_subs = topic.subscriptions token: tmp_subs.token\nend"}]},"params":[{"name":"token","types":["String"],"description":"The <code class=\"highlighter-rouge\">token</code> value returned by the last call to\n<code class=\"highlighter-rouge\">subscriptions</code>; indicates that this is a continuation of a call, and\nthat the system should return the next page of data.","optional":true,"default":"nil","nullable":true},{"name":"max","types":["Integer"],"description":"Maximum number of subscriptions to return.","optional":true,"default":"nil","nullable":true}],"exceptions":[],"returns":[{"types":["Array<Subscription>"],"description":"(See {Subscription::List})"}]},{"metadata":{"name":"publish","description":"<p>Publishes one or more messages to the topic.</p>","source":"lib/gcloud/pubsub/topic.rb#L304","resources":[],"examples":[{"caption":null,"code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\ntopic = pubsub.topic \"my-topic\"\nmsg = topic.publish \"new-message\""},{"caption":"Additionally, a message can be published with attributes:","code":"\nrequire \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\ntopic = pubsub.topic \"my-topic\"\nmsg = topic.publish \"new-message\",\n                    foo: :bar,\n                    this: :that"},{"caption":"Multiple messages can be sent at the same time using a block:","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\ntopic = pubsub.topic \"my-topic\"\nmsgs = topic.publish do |batch|\n  batch.publish \"new-message-1\", foo: :bar\n  batch.publish \"new-message-2\", foo: :baz\n  batch.publish \"new-message-3\", foo: :bif\nend"}]},"params":[{"name":"data","types":["String"],"description":"The message data.","optional":true,"default":"nil","nullable":true},{"name":"attributes","types":["Hash"],"description":"Optional attributes for the message.","optional":true,"default":"{}","nullable":false},{"name":"yield","types":["block"],"description":null,"optional":true,"nullable":false}],"exceptions":[],"returns":[{"types":["Message","Array<Message>"],"description":"Returns the published message when\ncalled without a block, or an array of messages when called with a\nblock."}]},{"metadata":{"name":"policy","description":"<p>Gets the access control policy.</p>","source":"lib/gcloud/pubsub/topic.rb#L349","resources":[],"examples":[{"caption":"Policy values are memoized to reduce the number of API calls:","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\ntopic = pubsub.topic \"my-topic\"\nputs topic.policy[\"bindings\"]\nputs topic.policy[\"rules\"]"},{"caption":"Use <code class=\"highlighter-rouge\">force</code> to retrieve the latest policy from the service:","code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\ntopic = pubsub.topic \"my-topic\"\npolicy = topic.policy force: true"}]},"params":[{"name":"force","types":["Boolean"],"description":"Force the latest policy to be retrieved from the\nPub/Sub service when <code class=\"highlighter-rouge\">true</code>. Otherwise the policy will be memoized to\nreduce the number of API calls made to the Pub/Sub service. The\ndefault is <code class=\"highlighter-rouge\">false</code>.","optional":true,"default":"nil","nullable":true}],"exceptions":[],"returns":[{"types":["Hash"],"description":"Returns a hash that conforms to the following structure:</p>\n\n<p>{\n  “etag”=&gt;”CAE=”,\n  “bindings” =&gt; [{\n    “role” =&gt; “roles/viewer”,\n    “members” =&gt; [“serviceAccount:your-service-account”]\n  }]\n}"}]},{"metadata":{"name":"policy=","description":"<p>Sets the access control policy.</p>","source":"lib/gcloud/pubsub/topic.rb#L388","resources":[],"examples":[{"caption":null,"code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\nviewer_policy = {\n  \"bindings\" => [{\n    \"role\" => \"roles/viewer\",\n    \"members\" => [\"serviceAccount:your-service-account\"]\n  }]\n}\ntopic = pubsub.topic \"my-topic\"\ntopic.policy = viewer_policy"}]},"params":[{"name":"new_policy","types":["String"],"description":"A hash that conforms to the following\nstructure:</p>\n\n<p>{\n    “bindings” =&gt; [{\n      “role” =&gt; “roles/viewer”,\n      “members” =&gt; [“serviceAccount:your-service-account”]\n    }]\n  }","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"metadata":{"name":"test_permissions","description":"<p>Tests the specified permissions against the <a href=\"https://cloud.google.com/iam/\">Cloud\nIAM</a> access control policy.</p>","source":"lib/gcloud/pubsub/topic.rb#L423","resources":[{"href":"https://cloud.google.com/iam/docs/managing-policies","title":"Managing\nPolicies"}],"examples":[{"caption":null,"code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\ntopic = pubsub.topic \"my-topic\"\nperms = topic.test_permissions \"projects.topic.list\",\n                               \"projects.topic.publish\"\nperms.include? \"projects.topic.list\" #=> true\nperms.include? \"projects.topic.publish\" #=> false"}]},"params":[{"name":"*permissions","types":["String","Array<String>"],"description":"The set of permissions to\ncheck access for. Permissions with wildcards (such as <code class=\"highlighter-rouge\">*</code> or\n<code class=\"highlighter-rouge\">storage.*</code>) are not allowed.","optional":false,"nullable":false}],"exceptions":[],"returns":[{"types":["Array<Strings>"],"description":"The permissions that have access."}]},{"metadata":{"name":"exists?","description":"<p>Determines whether the topic exists in the Pub/Sub service.</p>","source":"lib/gcloud/pubsub/topic.rb#L446","resources":[],"examples":[{"caption":null,"code":"require \"gcloud\"\n\ngcloud = Gcloud.new\npubsub = gcloud.pubsub\n\ntopic = pubsub.topic \"my-topic\"\ntopic.exists? #=> true"}]},"params":[],"exceptions":[],"returns":[{"types":["Boolean"],"description":null}]},{"metadata":{"name":"ensure_connection!","description":"<p>Raise an error unless an active connection is available.</p>","source":"lib/gcloud/pubsub/topic.rb#L485","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"ensure_gapi!","description":"<p>Ensures a Google API object exists.</p>","source":"lib/gcloud/pubsub/topic.rb#L491","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]},{"metadata":{"name":"publish_batch_messages","description":"<p>Call the publish API with arrays of data data and attrs.</p>","source":"lib/gcloud/pubsub/topic.rb#L500","resources":[],"examples":[]},"params":[],"exceptions":[],"returns":[]}]}