{"id":"dns","metadata":{"name":"Dns","description":"<h1 id=\"google-cloud-dns\">Google Cloud DNS</h1>  <p>Google Cloud DNS is a high-performance, resilient, global DNS service that provides a cost-effective way to make your applications and services available to your users. This programmable, authoritative DNS service can be used to easily publish and manage DNS records using the same infrastructure relied upon by Google. To learn more, read <a href=\"https://cloud.google.com/dns/what-is-cloud-dns\">What is Google Cloud DNS?</a>.</p>  <p>Gcloud’s goal is to provide an API that is familiar and comfortable to Rubyists. Authentication is handled by Gcloud#dns. You can provide the project and credential information to connect to the Cloud DNS service, or if you are running on Google Compute Engine this configuration is taken care of for you. You can read more about the options for connecting in the <a href=\"../AUTHENTICATION\">Authentication Guide</a>.</p>  <h2 id=\"creating-zones\">Creating Zones</h2>  <p>To get started with Google Cloud DNS, use your DNS Project to create a new Zone. The second argument to Project#create_zone must be a unique domain name for which you can <a href=\"https://www.google.com/webmasters/verification/home\">verify ownership</a>. Substitute a domain name of your own (ending with a dot to signify that it is <a href=\"https://en.wikipedia.org/wiki/Fully_qualified_domain_name\">fully qualified</a>) as you follow along with these examples.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">dns</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">dns</span> <span class=\"n\">zone</span> <span class=\"o\">=</span> <span class=\"n\">dns</span><span class=\"p\">.</span><span class=\"nf\">create_zone</span> <span class=\"s2\">\"example-com\"</span><span class=\"p\">,</span> <span class=\"s2\">\"example.com.\"</span> <span class=\"nb\">puts</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">id</span> <span class=\"c1\"># unique identifier defined by the server</span> </code></pre> </div>  <p>For more information, see <a href=\"https://cloud.google.com/dns/zones/\">Managing Zones</a>.</p>  <h2 id=\"listing-zones\">Listing Zones</h2>  <p>You can retrieve all the zones in your project.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">dns</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">dns</span> <span class=\"n\">zones</span> <span class=\"o\">=</span> <span class=\"n\">dns</span><span class=\"p\">.</span><span class=\"nf\">zones</span> <span class=\"n\">zones</span><span class=\"p\">.</span><span class=\"nf\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">zone</span><span class=\"o\">|</span>   <span class=\"nb\">puts</span> <span class=\"s2\">\"</span><span class=\"si\">#{</span><span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">name</span><span class=\"si\">}</span><span class=\"s2\"> - </span><span class=\"si\">#{</span><span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">dns</span><span class=\"si\">}</span><span class=\"s2\">\"</span> <span class=\"k\">end</span> </code></pre> </div>  <p>You can also retrieve a single zone by either name or id.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">dns</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">dns</span> <span class=\"n\">zone</span> <span class=\"o\">=</span> <span class=\"n\">dns</span><span class=\"p\">.</span><span class=\"nf\">zone</span> <span class=\"s2\">\"example-com\"</span> </code></pre> </div>  <h2 id=\"listing-records\">Listing Records</h2>  <p>When you create a zone, the Cloud DNS service automatically creates two Record instances for it, providing configuration for Cloud DNS nameservers. Let’s take a look at these records.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">dns</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">dns</span> <span class=\"n\">zone</span> <span class=\"o\">=</span> <span class=\"n\">dns</span><span class=\"p\">.</span><span class=\"nf\">zone</span> <span class=\"s2\">\"example-com\"</span> <span class=\"n\">records</span> <span class=\"o\">=</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">records</span> <span class=\"n\">records</span><span class=\"p\">.</span><span class=\"nf\">count</span> <span class=\"c1\">#=&gt; 2</span> <span class=\"n\">records</span><span class=\"p\">.</span><span class=\"nf\">map</span> <span class=\"o\">&amp;</span><span class=\"ss\">:type</span> <span class=\"c1\">#=&gt; [\"NS\", \"SOA\"]</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">records</span><span class=\"p\">.</span><span class=\"nf\">first</span><span class=\"p\">.</span><span class=\"nf\">data</span><span class=\"p\">.</span><span class=\"nf\">count</span> <span class=\"c1\">#=&gt; 4</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">records</span><span class=\"p\">.</span><span class=\"nf\">first</span><span class=\"p\">.</span><span class=\"nf\">data</span> <span class=\"c1\">#=&gt; [\"ns-cloud-d1.googledomains.com.\", ...]</span> </code></pre> </div>  <p>Note that Record#data returns an array. The Cloud DNS service only allows the zone to have one Record instance for each name and type combination. It supports multiple “resource records” (in this case, the four nameserver addresses) via this <code class=\"highlighter-rouge\">data</code> collection.</p>  <h2 id=\"managing-records\">Managing Records</h2>  <p>You can easily add your own records to the zone. Each call to Zone#add results in a new Cloud DNS Change instance.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">dns</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">dns</span> <span class=\"n\">zone</span> <span class=\"o\">=</span> <span class=\"n\">dns</span><span class=\"p\">.</span><span class=\"nf\">zone</span> <span class=\"s2\">\"example-com\"</span> <span class=\"n\">change</span> <span class=\"o\">=</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">add</span> <span class=\"s2\">\"www\"</span><span class=\"p\">,</span> <span class=\"s2\">\"A\"</span><span class=\"p\">,</span> <span class=\"mi\">86400</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s2\">\"1.2.3.4\"</span><span class=\"p\">]</span> <span class=\"n\">change</span><span class=\"p\">.</span><span class=\"nf\">additions</span><span class=\"p\">.</span><span class=\"nf\">map</span> <span class=\"o\">&amp;</span><span class=\"ss\">:type</span> <span class=\"c1\">#=&gt; [\"A\", \"SOA\"]</span> <span class=\"n\">change</span><span class=\"p\">.</span><span class=\"nf\">deletions</span><span class=\"p\">.</span><span class=\"nf\">map</span> <span class=\"o\">&amp;</span><span class=\"ss\">:type</span> <span class=\"c1\">#=&gt; [\"SOA\"]</span> </code></pre> </div>  <p>Whenever you change the set of records belonging to a zone, the zone’s start of authority (SOA) record should be updated with a higher serial number. The gcloud library automates this update for you, deleting the old SOA record and adding an updated one, as shown in the example above. You can disable or modify this behavior, of course. See Zone#update for details.</p>  <p>You can retrieve records by name and type. The name argument can be a subdomain (e.g., <code class=\"highlighter-rouge\">www</code>) fragment for convenience, but notice that the retrieved record’s domain name is always fully-qualified.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">dns</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">dns</span> <span class=\"n\">zone</span> <span class=\"o\">=</span> <span class=\"n\">dns</span><span class=\"p\">.</span><span class=\"nf\">zone</span> <span class=\"s2\">\"example-com\"</span> <span class=\"n\">records</span> <span class=\"o\">=</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">records</span> <span class=\"s2\">\"www\"</span><span class=\"p\">,</span> <span class=\"s2\">\"A\"</span> <span class=\"n\">records</span><span class=\"p\">.</span><span class=\"nf\">first</span><span class=\"p\">.</span><span class=\"nf\">name</span> <span class=\"c1\">#=&gt; \"www.example.com.\"</span> </code></pre> </div>  <p>You can use Zone#replace to update the <code class=\"highlighter-rouge\">ttl</code> and <code class=\"highlighter-rouge\">data</code> for a record.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">dns</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">dns</span> <span class=\"n\">zone</span> <span class=\"o\">=</span> <span class=\"n\">dns</span><span class=\"p\">.</span><span class=\"nf\">zone</span> <span class=\"s2\">\"example-com\"</span> <span class=\"n\">change</span> <span class=\"o\">=</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">replace</span> <span class=\"s2\">\"www\"</span><span class=\"p\">,</span> <span class=\"s2\">\"A\"</span><span class=\"p\">,</span> <span class=\"mi\">86400</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s2\">\"5.6.7.8\"</span><span class=\"p\">]</span> </code></pre> </div>  <p>Or, you can use Zone#modify to update just the <code class=\"highlighter-rouge\">ttl</code> or <code class=\"highlighter-rouge\">data</code>, without the risk of inadvertently changing values that you wish to leave unchanged.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">dns</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">dns</span> <span class=\"n\">zone</span> <span class=\"o\">=</span> <span class=\"n\">dns</span><span class=\"p\">.</span><span class=\"nf\">zone</span> <span class=\"s2\">\"example-com\"</span> <span class=\"n\">change</span> <span class=\"o\">=</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">modify</span> <span class=\"s2\">\"www\"</span><span class=\"p\">,</span> <span class=\"s2\">\"A\"</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">r</span><span class=\"o\">|</span>   <span class=\"n\">r</span><span class=\"p\">.</span><span class=\"nf\">ttl</span> <span class=\"o\">=</span> <span class=\"mi\">3600</span> <span class=\"c1\"># change only the TTL</span> <span class=\"k\">end</span> </code></pre> </div>  <p>You can also delete records by name and type.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">dns</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">dns</span> <span class=\"n\">zone</span> <span class=\"o\">=</span> <span class=\"n\">dns</span><span class=\"p\">.</span><span class=\"nf\">zone</span> <span class=\"s2\">\"example-com\"</span> <span class=\"n\">change</span> <span class=\"o\">=</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">remove</span> <span class=\"s2\">\"www\"</span><span class=\"p\">,</span> <span class=\"s2\">\"A\"</span> <span class=\"n\">record</span> <span class=\"o\">=</span> <span class=\"n\">change</span><span class=\"p\">.</span><span class=\"nf\">deletions</span><span class=\"p\">.</span><span class=\"nf\">first</span> </code></pre> </div>  <p>The best way to add, remove, and update multiple records in a single <a href=\"https://cloud.google.com/dns/records\">transaction</a> is to call Zone#update with a block. See Zone::Transaction.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">dns</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">dns</span> <span class=\"n\">zone</span> <span class=\"o\">=</span> <span class=\"n\">dns</span><span class=\"p\">.</span><span class=\"nf\">zone</span> <span class=\"s2\">\"example-com\"</span> <span class=\"n\">change</span> <span class=\"o\">=</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">update</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">tx</span><span class=\"o\">|</span>   <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"nf\">add</span>     <span class=\"s2\">\"www\"</span><span class=\"p\">,</span> <span class=\"s2\">\"A\"</span><span class=\"p\">,</span>  <span class=\"mi\">86400</span><span class=\"p\">,</span> <span class=\"s2\">\"1.2.3.4\"</span>   <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"nf\">remove</span>  <span class=\"s2\">\"example.com.\"</span><span class=\"p\">,</span> <span class=\"s2\">\"TXT\"</span>   <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"nf\">replace</span> <span class=\"s2\">\"example.com.\"</span><span class=\"p\">,</span> <span class=\"s2\">\"MX\"</span><span class=\"p\">,</span> <span class=\"mi\">86400</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s2\">\"10 mail1.example.com.\"</span><span class=\"p\">,</span>                                            <span class=\"s2\">\"20 mail2.example.com.\"</span><span class=\"p\">]</span>   <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"nf\">modify</span> <span class=\"s2\">\"www.example.com.\"</span><span class=\"p\">,</span> <span class=\"s2\">\"CNAME\"</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">r</span><span class=\"o\">|</span>     <span class=\"n\">r</span><span class=\"p\">.</span><span class=\"nf\">ttl</span> <span class=\"o\">=</span> <span class=\"mi\">86400</span> <span class=\"c1\"># only change the TTL</span>   <span class=\"k\">end</span> <span class=\"k\">end</span> </code></pre> </div>  <p>Finally, you can add and delete records by reference, using Zone#update.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">dns</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">dns</span> <span class=\"n\">zone</span> <span class=\"o\">=</span> <span class=\"n\">dns</span><span class=\"p\">.</span><span class=\"nf\">zone</span> <span class=\"s2\">\"example-com\"</span> <span class=\"n\">to_add</span> <span class=\"o\">=</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">record</span> <span class=\"s2\">\"www\"</span><span class=\"p\">,</span> <span class=\"s2\">\"AAAA\"</span><span class=\"p\">,</span> <span class=\"mi\">86400</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s2\">\"2607:f8b0:400a:801::1005\"</span><span class=\"p\">]</span> <span class=\"n\">to_delete</span> <span class=\"o\">=</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">records</span> <span class=\"s2\">\"www\"</span><span class=\"p\">,</span> <span class=\"s2\">\"A\"</span> <span class=\"n\">change</span> <span class=\"o\">=</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">update</span> <span class=\"n\">to_add</span><span class=\"p\">,</span> <span class=\"n\">to_delete</span> </code></pre> </div>  <h2 id=\"listing-changes\">Listing Changes</h2>  <p>Because the transactions you execute against your zone do not always complete immediately, you can retrieve and inspect changes.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">dns</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">dns</span> <span class=\"n\">zone</span> <span class=\"o\">=</span> <span class=\"n\">dns</span><span class=\"p\">.</span><span class=\"nf\">zone</span> <span class=\"s2\">\"example-com\"</span> <span class=\"n\">changes</span> <span class=\"o\">=</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">changes</span> <span class=\"n\">changes</span><span class=\"p\">.</span><span class=\"nf\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">change</span><span class=\"o\">|</span>   <span class=\"nb\">puts</span> <span class=\"s2\">\"</span><span class=\"si\">#{</span><span class=\"n\">change</span><span class=\"p\">.</span><span class=\"nf\">id</span><span class=\"si\">}</span><span class=\"s2\"> - </span><span class=\"si\">#{</span><span class=\"n\">change</span><span class=\"p\">.</span><span class=\"nf\">started_at</span><span class=\"si\">}</span><span class=\"s2\"> - </span><span class=\"si\">#{</span><span class=\"n\">change</span><span class=\"p\">.</span><span class=\"nf\">status</span><span class=\"si\">}</span><span class=\"s2\">\"</span> <span class=\"k\">end</span> </code></pre> </div>  <h2 id=\"importing-and-exporting-zone-files\">Importing and exporting zone files</h2>  <p>You can import from a zone file. Because the Cloud DNS service only allows the zone to have one Record instance for each name and type combination, lines may be merged as needed into records with multiple <code class=\"highlighter-rouge\">data</code> values.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">dns</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">dns</span> <span class=\"n\">zone</span> <span class=\"o\">=</span> <span class=\"n\">dns</span><span class=\"p\">.</span><span class=\"nf\">zone</span> <span class=\"s2\">\"example-com\"</span> <span class=\"n\">change</span> <span class=\"o\">=</span> <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">import</span> <span class=\"s2\">\"path/to/db.example.com\"</span> </code></pre> </div>  <p>You can also export to a zone file.</p>  <div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>  <span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"n\">dns</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">dns</span> <span class=\"n\">zone</span> <span class=\"o\">=</span> <span class=\"n\">dns</span><span class=\"p\">.</span><span class=\"nf\">zone</span> <span class=\"s2\">\"example-com\"</span>  <span class=\"n\">zone</span><span class=\"p\">.</span><span class=\"nf\">export</span> <span class=\"s2\">\"path/to/db.example.com\"</span> </code></pre> </div>","source":"lib/gcloud/dns.rb#L296","resources":[],"examples":[]},"methods":[]}