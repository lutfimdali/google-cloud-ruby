{"id":"gcloud/datastore","name":"Datastore","title":["Gcloud","Datastore"],"description":"<h1 id=\"google-cloud-datastore\">Google Cloud Datastore</h1>\n\n<p>Google Cloud Datastore is a fully managed, schemaless database for storing\nnon-relational data. You should feel at home if you are familiar with\nrelational databases, but there are some key differences to be aware of to\nmake the most of using Datastore.</p>\n\n<p>Gcloud’s goal is to provide a API that is familiar and comfortable to\nRubyists. Authentication is handled by Gcloud#datastore. You can provide\nthe project and credential information to connect to the Datastore service,\nor if you are running on Google Compute Engine this configuration is taken\ncare of for you.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span> <span class=\"s2\">\"my-todo-project\"</span><span class=\"p\">,</span>\n                    <span class=\"s2\">\"/path/to/keyfile.json\"</span>\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">datastore</span>\n<span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">find</span> <span class=\"s2\">\"Task\"</span><span class=\"p\">,</span> <span class=\"s2\">\"start\"</span>\n<span class=\"n\">entity</span><span class=\"p\">[</span><span class=\"s2\">\"completed\"</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kp\">true</span>\n<span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">save</span> <span class=\"n\">entity</span>\n</code></pre>\n</div>\n\n<p>You can learn more about various options for connection on the\n<a href=\"../AUTHENTICATION\">Authentication Guide</a>.</p>\n\n<p>To learn more about Datastore, read the\n<a href=\"https://cloud.google.com/datastore/docs/concepts/overview\">Google Cloud Datastore Concepts Overview\n</a>.</p>\n\n<h2 id=\"retrieving-records\">Retrieving Records</h2>\n\n<p>Records, called “entities” in Datastore, are retrieved by using a Key.\nThe Key is more than a numeric identifier, it is a complex data structure\nthat can be used to model relationships. The simplest Key has a string\n<tt>kind</tt> value, and either a numeric <tt>id</tt> value, or a string\n<tt>name</tt> value. A single record can be retrieved by calling\nGcloud::Datastore::Dataset#find and passing the parts of the key:</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">datastore</span>\n<span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">find</span> <span class=\"s2\">\"Task\"</span><span class=\"p\">,</span> <span class=\"s2\">\"start\"</span>\n</code></pre>\n</div>\n\n<p>Optionally, Gcloud::Datastore::Dataset#find can be given a Key object:</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">datastore</span>\n<span class=\"n\">key</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">key</span> <span class=\"s2\">\"Task\"</span><span class=\"p\">,</span> <span class=\"mi\">12345</span>\n<span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">find</span> <span class=\"n\">key</span>\n</code></pre>\n</div>\n\n<p>See Gcloud::Datastore::Dataset#find</p>\n\n<h2 id=\"querying-records\">Querying Records</h2>\n\n<p>Multiple records can be found that match criteria.\n(See Gcloud::Datastore::Query#where)</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">datastore</span>\n<span class=\"n\">query</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">query</span><span class=\"p\">(</span><span class=\"s2\">\"List\"</span><span class=\"p\">).</span>\n  <span class=\"nf\">where</span><span class=\"p\">(</span><span class=\"s2\">\"active\"</span><span class=\"p\">,</span> <span class=\"s2\">\"=\"</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">)</span>\n<span class=\"n\">active_lists</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">run</span> <span class=\"n\">query</span>\n</code></pre>\n</div>\n\n<p>Records can also be ordered. (See Gcloud::Datastore::Query#order)</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">datastore</span>\n<span class=\"n\">query</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">query</span><span class=\"p\">(</span><span class=\"s2\">\"List\"</span><span class=\"p\">).</span>\n  <span class=\"nf\">where</span><span class=\"p\">(</span><span class=\"s2\">\"active\"</span><span class=\"p\">,</span> <span class=\"s2\">\"=\"</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">).</span>\n  <span class=\"nf\">order</span><span class=\"p\">(</span><span class=\"s2\">\"name\"</span><span class=\"p\">)</span>\n<span class=\"n\">active_lists</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">run</span> <span class=\"n\">query</span>\n</code></pre>\n</div>\n\n<p>The number of records returned can be specified.\n(See Gcloud::Datastore::Query#limit)</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">datastore</span>\n<span class=\"n\">query</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">query</span><span class=\"p\">(</span><span class=\"s2\">\"List\"</span><span class=\"p\">).</span>\n  <span class=\"nf\">where</span><span class=\"p\">(</span><span class=\"s2\">\"active\"</span><span class=\"p\">,</span> <span class=\"s2\">\"=\"</span><span class=\"p\">,</span> <span class=\"kp\">true</span><span class=\"p\">).</span>\n  <span class=\"nf\">order</span><span class=\"p\">(</span><span class=\"s2\">\"name\"</span><span class=\"p\">).</span>\n  <span class=\"nf\">limit</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">)</span>\n<span class=\"n\">active_lists</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">run</span> <span class=\"n\">query</span>\n</code></pre>\n</div>\n\n<p>Records’ Key structures can also be queried.\n(See Gcloud::Datastore::Query#ancestor)</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">datastore</span>\n\n<span class=\"n\">list</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">find</span> <span class=\"s2\">\"List\"</span><span class=\"p\">,</span> <span class=\"s2\">\"todos\"</span>\n<span class=\"n\">query</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">query</span><span class=\"p\">(</span><span class=\"s2\">\"Task\"</span><span class=\"p\">).</span>\n  <span class=\"nf\">ancestor</span><span class=\"p\">(</span><span class=\"n\">list</span><span class=\"p\">.</span><span class=\"nf\">key</span><span class=\"p\">)</span>\n<span class=\"n\">items</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">run</span> <span class=\"n\">query</span>\n</code></pre>\n</div>\n\n<p>See Gcloud::Datastore::Query and Gcloud::Datastore::Dataset#run</p>\n\n<h2 id=\"paginating-records\">Paginating Records</h2>\n\n<p>All Records may not return at once, requiring multiple calls to Datastore\nto return them all. The returned records will have a <tt>cursor</tt> if\nthere are more available.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">datastore</span>\n\n<span class=\"n\">list</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">find</span> <span class=\"s2\">\"List\"</span><span class=\"p\">,</span> <span class=\"s2\">\"todos\"</span>\n<span class=\"n\">query</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">query</span><span class=\"p\">(</span><span class=\"s2\">\"Task\"</span><span class=\"p\">).</span>\n  <span class=\"nf\">ancestor</span><span class=\"p\">(</span><span class=\"n\">list</span><span class=\"p\">.</span><span class=\"nf\">key</span><span class=\"p\">)</span>\n<span class=\"n\">all_tasks</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n<span class=\"n\">tmp_tasks</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">run</span> <span class=\"n\">query</span>\n<span class=\"k\">while</span> <span class=\"n\">tmp_tasks</span><span class=\"p\">.</span><span class=\"nf\">any?</span> <span class=\"k\">do</span>\n  <span class=\"n\">tmp_tasks</span><span class=\"p\">.</span><span class=\"nf\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">task</span><span class=\"o\">|</span>\n    <span class=\"n\">all_tasks</span> <span class=\"o\">&lt;&lt;</span> <span class=\"n\">task</span>\n  <span class=\"k\">end</span>\n  <span class=\"c1\"># break loop if no more tasks available</span>\n  <span class=\"k\">break</span> <span class=\"k\">if</span> <span class=\"n\">tmp_tasks</span><span class=\"p\">.</span><span class=\"nf\">cursor</span><span class=\"p\">.</span><span class=\"nf\">nil?</span>\n  <span class=\"c1\"># set cursor on the query</span>\n  <span class=\"n\">query</span> <span class=\"o\">=</span> <span class=\"n\">query</span><span class=\"p\">.</span><span class=\"nf\">cursor</span> <span class=\"n\">tmp_tasks</span><span class=\"p\">.</span><span class=\"nf\">cursor</span>\n  <span class=\"c1\"># query for more records</span>\n  <span class=\"n\">tmp_tasks</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">run</span> <span class=\"n\">query</span>\n<span class=\"k\">end</span>\n</code></pre>\n</div>\n\n<p>See Gcloud::Datastore::Dataset::LookupResults and\nGcloud::Datastore::Dataset::QueryResults</p>\n\n<h2 id=\"creating-records\">Creating Records</h2>\n\n<p>New entities can be created and persisted buy calling Dataset#save.\nThe entity must have a Key to be saved. If the Key is incomplete then\nit will be completed when saved.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">datastore</span>\n<span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">entity</span> <span class=\"s2\">\"User\"</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">e</span><span class=\"o\">|</span>\n  <span class=\"n\">e</span><span class=\"p\">[</span><span class=\"s2\">\"name\"</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s2\">\"Heidi Henderson\"</span>\n<span class=\"k\">end</span>\n<span class=\"n\">entity</span><span class=\"p\">.</span><span class=\"nf\">key</span><span class=\"p\">.</span><span class=\"nf\">id</span> <span class=\"c1\">#=&gt; nil</span>\n<span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">save</span> <span class=\"n\">entity</span>\n<span class=\"n\">entity</span><span class=\"p\">.</span><span class=\"nf\">key</span><span class=\"p\">.</span><span class=\"nf\">id</span> <span class=\"c1\">#=&gt; 123456789</span>\n</code></pre>\n</div>\n\n<h2 id=\"updating-records\">Updating Records</h2>\n\n<p>Entities hold properties. A property has a name that is a string or symbol,\nand a value that is an object. Most value objects are supported, including\nString, Integer, Date, Time, and even other Entity or Key objects. Changes\nto the Entity’s properties are persisted by calling Dataset#save.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">datastore</span>\n<span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">find</span> <span class=\"s2\">\"User\"</span><span class=\"p\">,</span> <span class=\"s2\">\"heidi\"</span>\n<span class=\"c1\"># Read the status property</span>\n<span class=\"n\">entity</span><span class=\"p\">[</span><span class=\"s2\">\"status\"</span><span class=\"p\">]</span> <span class=\"c1\">#=&gt; \"inactive\"</span>\n<span class=\"c1\"># Write the status property</span>\n<span class=\"n\">entity</span><span class=\"p\">[</span><span class=\"s2\">\"status\"</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s2\">\"active\"</span>\n<span class=\"c1\"># Persist the changes</span>\n<span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">save</span> <span class=\"n\">entity</span>\n</code></pre>\n</div>\n\n<h2 id=\"deleting-records\">Deleting Records</h2>\n\n<p>Entities can be removed from Datastore by calling Dataset#delete and passing\nthe Entity object or the entity’s Key object.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">datastore</span>\n<span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">find</span> <span class=\"s2\">\"User\"</span><span class=\"p\">,</span> <span class=\"s2\">\"heidi\"</span>\n<span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">delete</span> <span class=\"n\">entity</span>\n</code></pre>\n</div>\n\n<h2 id=\"transactions\">Transactions</h2>\n\n<p>Complex logic can be wrapped in a Transaction. All queries and updates\nwithin the Dataset#transaction block are run within the transaction scope,\nand will be automatically committed when the block completes.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">datastore</span>\n\n<span class=\"n\">key</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">key</span> <span class=\"s2\">\"User\"</span><span class=\"p\">,</span> <span class=\"s2\">\"heidi\"</span>\n\n<span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">entity</span> <span class=\"n\">key</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">u</span><span class=\"o\">|</span>\n  <span class=\"n\">u</span><span class=\"p\">[</span><span class=\"s2\">\"name\"</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s2\">\"Heidi Henderson\"</span>\n  <span class=\"n\">u</span><span class=\"p\">[</span><span class=\"s2\">\"email\"</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s2\">\"heidi@example.net\"</span>\n<span class=\"k\">end</span>\n\n<span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">transaction</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">tx</span><span class=\"o\">|</span>\n  <span class=\"k\">if</span> <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"nf\">find</span><span class=\"p\">(</span><span class=\"n\">user</span><span class=\"p\">.</span><span class=\"nf\">key</span><span class=\"p\">).</span><span class=\"nf\">nil?</span>\n    <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"nf\">save</span> <span class=\"n\">user</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre>\n</div>\n\n<p>Alternatively, if no block is given the transaction object is returned\nallowing you to commit or rollback manually.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">datastore</span>\n\n<span class=\"n\">key</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">key</span> <span class=\"s2\">\"User\"</span><span class=\"p\">,</span> <span class=\"s2\">\"heidi\"</span>\n\n<span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">entity</span> <span class=\"n\">key</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">u</span><span class=\"o\">|</span>\n  <span class=\"n\">u</span><span class=\"p\">[</span><span class=\"s2\">\"name\"</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s2\">\"Heidi Henderson\"</span>\n  <span class=\"n\">u</span><span class=\"p\">[</span><span class=\"s2\">\"email\"</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s2\">\"heidi@example.net\"</span>\n<span class=\"k\">end</span>\n\n<span class=\"n\">tx</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">.</span><span class=\"nf\">transaction</span>\n<span class=\"k\">begin</span>\n  <span class=\"k\">if</span> <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"nf\">find</span><span class=\"p\">(</span><span class=\"n\">user</span><span class=\"p\">.</span><span class=\"nf\">key</span><span class=\"p\">).</span><span class=\"nf\">nil?</span>\n    <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"nf\">save</span> <span class=\"n\">user</span>\n  <span class=\"k\">end</span>\n  <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"nf\">commit</span>\n<span class=\"k\">rescue</span>\n  <span class=\"n\">tx</span><span class=\"p\">.</span><span class=\"nf\">rollback</span>\n<span class=\"k\">end</span>\n</code></pre>\n</div>\n\n<p>See Gcloud::Datastore::Transaction and\nGcloud::Datastore::Dataset#transaction</p>","source":"lib/gcloud/datastore.rb#L330","resources":[],"examples":[],"methods":[]}