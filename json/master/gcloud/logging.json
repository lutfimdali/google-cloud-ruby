{"id":"gcloud/logging","name":"Logging","title":["Gcloud","Logging"],"description":"<h1 id=\"google-cloud-logging\">Google Cloud Logging</h1>\n\n<p>The Google Cloud Logging service collects and stores logs from applications\nand services on the Google Cloud Platform, giving you fine-grained,\nprogrammatic control over your projects’ logs. You can use the Cloud Logging\nAPI to:</p>\n\n<ul>\n  <li><a href=\"#listing-log-entries\">Read and filter log entries</a></li>\n  <li><a href=\"#exporting-log-entries\">Export your log entries</a> to Cloud Storage,\nBigQuery, or Cloud Pub/Sub</li>\n  <li><a href=\"#creating-logs-based-metrics\">Create logs-based metrics</a> for use in Cloud\nMonitoring</li>\n  <li><a href=\"#writing-log-entries\">Write log entries</a></li>\n</ul>\n\n<p>For general information about Cloud Logging, read <a href=\"https://cloud.google.com/logging/docs/\">What is Google Cloud\nLogging?</a>.</p>\n\n<p>Gcloud’s goal is to provide an API that is familiar and comfortable to\nRubyists. Authentication is handled by <a data-custom-type=\"gcloud~logging\">Gcloud#logging</a>. You can provide\nthe project and credential information to connect to the Cloud Logging\nservice, or if you are running on Google Compute Engine this configuration\nis taken care of for you. You can read more about the options for connecting\nin the <a href=\"../AUTHENTICATION\">Authentication Guide</a>.</p>\n\n<h2 id=\"listing-log-entries\">Listing log entries</h2>\n\n<p>Cloud Logging gathers log entries from many services, including Google App\nEngine and Google Compute Engine. (See the <a href=\"https://cloud.google.com/logging/docs/view/logs_index\">List of Log\nTypes</a>.) In addition,\nyou can write your own log entries to the service.</p>\n\n<p><a data-custom-type=\"gcloud/logging/project~entries\">Gcloud::Logging::Project#entries</a> returns the <a data-custom-type=\"gcloud/logging/entry\">Gcloud::Logging::Entry</a>\nrecords belonging to your project:</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">logging</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">logging</span>\n<span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">entries</span>\n<span class=\"n\">entries</span><span class=\"p\">.</span><span class=\"nf\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">e</span><span class=\"o\">|</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"[</span><span class=\"si\">#{</span><span class=\"n\">e</span><span class=\"p\">.</span><span class=\"nf\">timestamp</span><span class=\"si\">}</span><span class=\"s2\">] </span><span class=\"si\">#{</span><span class=\"n\">e</span><span class=\"p\">.</span><span class=\"nf\">log_name</span><span class=\"si\">}</span><span class=\"s2\"> </span><span class=\"si\">#{</span><span class=\"n\">e</span><span class=\"p\">.</span><span class=\"nf\">payload</span><span class=\"p\">.</span><span class=\"nf\">inspect</span><span class=\"si\">}</span><span class=\"s2\">\"</span>\n<span class=\"k\">end</span>\n</code></pre>\n</div>\n\n<p>You can narrow the results to a single log using an <a href=\"https://cloud.google.com/logging/docs/view/advanced_filters\">advanced logs\nfilter</a>. A\nlog is a named collection of entries. Logs can be produced by Google Cloud\nPlatform services, by third-party services, or by your applications. For\nexample, the log <code class=\"highlighter-rouge\">compute.googleapis.com/activity_log</code> is produced by Google\nCompute Engine. Logs are simply referenced by name in Gcloud. There is no\n<code class=\"highlighter-rouge\">Log</code> type in Gcloud or <code class=\"highlighter-rouge\">Log</code> resource in the Cloud Logging API.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">logging</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">logging</span>\n<span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">entries</span> <span class=\"ss\">filter: </span><span class=\"s2\">\"log:syslog\"</span>\n<span class=\"n\">entries</span><span class=\"p\">.</span><span class=\"nf\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">e</span><span class=\"o\">|</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"[</span><span class=\"si\">#{</span><span class=\"n\">e</span><span class=\"p\">.</span><span class=\"nf\">timestamp</span><span class=\"si\">}</span><span class=\"s2\">] </span><span class=\"si\">#{</span><span class=\"n\">e</span><span class=\"p\">.</span><span class=\"nf\">payload</span><span class=\"p\">.</span><span class=\"nf\">inspect</span><span class=\"si\">}</span><span class=\"s2\">\"</span>\n<span class=\"k\">end</span>\n</code></pre>\n</div>\n\n<p>You can also order the log entries by <code class=\"highlighter-rouge\">timestamp</code>.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">logging</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">logging</span>\n<span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">entries</span> <span class=\"ss\">order: </span><span class=\"s2\">\"timestamp desc\"</span>\n<span class=\"n\">entries</span><span class=\"p\">.</span><span class=\"nf\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">e</span><span class=\"o\">|</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"[</span><span class=\"si\">#{</span><span class=\"n\">e</span><span class=\"p\">.</span><span class=\"nf\">timestamp</span><span class=\"si\">}</span><span class=\"s2\">] </span><span class=\"si\">#{</span><span class=\"n\">e</span><span class=\"p\">.</span><span class=\"nf\">log_name</span><span class=\"si\">}</span><span class=\"s2\"> </span><span class=\"si\">#{</span><span class=\"n\">e</span><span class=\"p\">.</span><span class=\"nf\">payload</span><span class=\"p\">.</span><span class=\"nf\">inspect</span><span class=\"si\">}</span><span class=\"s2\">\"</span>\n<span class=\"k\">end</span>\n</code></pre>\n</div>\n\n<h2 id=\"exporting-log-entries\">Exporting log entries</h2>\n\n<p>Cloud Logging lets you export log entries to destinations including Google\nCloud Storage buckets (for long term log storage), Google BigQuery datasets\n(for log analysis), and Google Pub/Sub (for streaming to other\napplications).</p>\n\n<h3 id=\"creating-sinks\">Creating sinks</h3>\n\n<p>A <a data-custom-type=\"gcloud/logging/sink\">Gcloud::Logging::Sink</a> is an object that lets you to specify a set of log\nentries to export.</p>\n\n<p>In addition to the name of the sink and the export destination,\n<a data-custom-type=\"gcloud/logging/project~create_sink\">Gcloud::Logging::Project#create_sink</a> accepts an <a href=\"https://cloud.google.com/logging/docs/view/advanced_filters\">advanced\nlogs filter</a> to\nnarrow the collection.</p>\n\n<p>Before creating the sink, ensure that you have granted\n<code class=\"highlighter-rouge\">cloud-logs@google.com</code> permission to write logs to the destination. See\n<a href=\"https://cloud.google.com/logging/docs/export/configure_export#setting_product_name_short_permissions_for_writing_exported_logs\">Permissions for writing exported\nlogs</a>.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">logging</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">logging</span>\n<span class=\"n\">storage</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">storage</span>\n\n<span class=\"n\">bucket</span> <span class=\"o\">=</span> <span class=\"n\">storage</span><span class=\"p\">.</span><span class=\"nf\">create_bucket</span> <span class=\"s2\">\"my-logs-bucket\"</span>\n\n<span class=\"c1\"># Grant owner permission to Cloud Logging service</span>\n<span class=\"n\">email</span> <span class=\"o\">=</span> <span class=\"s2\">\"cloud-logs@google.com\"</span>\n<span class=\"n\">bucket</span><span class=\"p\">.</span><span class=\"nf\">acl</span><span class=\"p\">.</span><span class=\"nf\">add_owner</span> <span class=\"s2\">\"group-</span><span class=\"si\">#{</span><span class=\"n\">email</span><span class=\"si\">}</span><span class=\"s2\">\"</span>\n\n<span class=\"n\">sink</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">create_sink</span> <span class=\"s2\">\"my-sink\"</span><span class=\"p\">,</span> <span class=\"s2\">\"storage.googleapis.com/</span><span class=\"si\">#{</span><span class=\"n\">bucket</span><span class=\"p\">.</span><span class=\"nf\">id</span><span class=\"si\">}</span><span class=\"s2\">\"</span>\n</code></pre>\n</div>\n\n<p>When you create a sink, only new log entries are exported. Cloud Logging\ndoes not send previously-ingested log entries to the sink’s destination.</p>\n\n<h3 id=\"listing-sinks\">Listing sinks</h3>\n\n<p>You can also list the sinks belonging to your project with\n<a data-custom-type=\"gcloud/logging/project~sinks\">Gcloud::Logging::Project#sinks</a>.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">logging</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">logging</span>\n<span class=\"n\">sinks</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">sinks</span>\n<span class=\"n\">sinks</span><span class=\"p\">.</span><span class=\"nf\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">s</span><span class=\"o\">|</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"</span><span class=\"si\">#{</span><span class=\"n\">s</span><span class=\"p\">.</span><span class=\"nf\">name</span><span class=\"si\">}</span><span class=\"s2\">: </span><span class=\"si\">#{</span><span class=\"n\">s</span><span class=\"p\">.</span><span class=\"nf\">filter</span><span class=\"si\">}</span><span class=\"s2\"> -&gt; </span><span class=\"si\">#{</span><span class=\"n\">s</span><span class=\"p\">.</span><span class=\"nf\">destination</span><span class=\"si\">}</span><span class=\"s2\">\"</span>\n<span class=\"k\">end</span>\n</code></pre>\n</div>\n\n<h2 id=\"creating-logs-based-metrics\">Creating logs-based metrics</h2>\n\n<p>You can use log entries in your project as the basis for <a href=\"https://cloud.google.com/monitoring/docs\">Google Cloud\nMonitoring</a> metrics. These metrics\ncan then be used to produce Cloud Monitoring reports and alerts.</p>\n\n<h3 id=\"creating-metrics\">Creating metrics</h3>\n\n<p>A metric is a measured value that can be used to assess a system. Use\n<a data-custom-type=\"gcloud/logging/project~create_metric\">Gcloud::Logging::Project#create_metric</a> to configure a\n<a data-custom-type=\"gcloud/logging/metric\">Gcloud::Logging::Metric</a> based on a collection of log entries matching an\n<a href=\"https://cloud.google.com/logging/docs/view/advanced_filters\">advanced\nlogs filter</a>.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">logging</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">logging</span>\n<span class=\"n\">metric</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">create_metric</span> <span class=\"s2\">\"errors\"</span><span class=\"p\">,</span> <span class=\"s2\">\"severity&gt;=ERROR\"</span>\n</code></pre>\n</div>\n\n<h3 id=\"listing-metrics\">Listing metrics</h3>\n\n<p>You can also list the metrics belonging to your project with\n<a data-custom-type=\"gcloud/logging/project~metrics\">Gcloud::Logging::Project#metrics</a>.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">logging</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">logging</span>\n<span class=\"n\">metrics</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">metrics</span>\n<span class=\"n\">metrics</span><span class=\"p\">.</span><span class=\"nf\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">m</span><span class=\"o\">|</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"</span><span class=\"si\">#{</span><span class=\"n\">m</span><span class=\"p\">.</span><span class=\"nf\">name</span><span class=\"si\">}</span><span class=\"s2\">: </span><span class=\"si\">#{</span><span class=\"n\">m</span><span class=\"p\">.</span><span class=\"nf\">filter</span><span class=\"si\">}</span><span class=\"s2\">\"</span>\n<span class=\"k\">end</span>\n</code></pre>\n</div>\n\n<h2 id=\"writing-log-entries\">Writing log entries</h2>\n\n<p>An <a data-custom-type=\"gcloud/logging/entry\">Gcloud::Logging::Entry</a> is composed of metadata and a payload. The\npayload is traditionally a message string, but in Cloud Logging it can\nalso be a JSON or protocol buffer object. A single log can have entries with\ndifferent payload types. In addition to the payload, your argument(s) to\n<a data-custom-type=\"gcloud/logging/project~write_entries\">Gcloud::Logging::Project#write_entries</a> must also contain a log name and a\nresource.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">logging</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">logging</span>\n\n<span class=\"n\">entry</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">entry</span>\n<span class=\"n\">entry</span><span class=\"p\">.</span><span class=\"nf\">payload</span> <span class=\"o\">=</span> <span class=\"s2\">\"Job started.\"</span>\n<span class=\"n\">entry</span><span class=\"p\">.</span><span class=\"nf\">log_name</span> <span class=\"o\">=</span> <span class=\"s2\">\"my_app_log\"</span>\n<span class=\"n\">entry</span><span class=\"p\">.</span><span class=\"nf\">resource</span><span class=\"p\">.</span><span class=\"nf\">type</span> <span class=\"o\">=</span> <span class=\"s2\">\"gae_app\"</span>\n<span class=\"n\">entry</span><span class=\"p\">.</span><span class=\"nf\">resource</span><span class=\"p\">.</span><span class=\"nf\">labels</span><span class=\"p\">[</span><span class=\"ss\">:module_id</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s2\">\"1\"</span>\n<span class=\"n\">entry</span><span class=\"p\">.</span><span class=\"nf\">resource</span><span class=\"p\">.</span><span class=\"nf\">labels</span><span class=\"p\">[</span><span class=\"ss\">:version_id</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s2\">\"20150925t173233\"</span>\n\n<span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">write_entries</span> <span class=\"n\">entry</span>\n</code></pre>\n</div>\n\n<p>If you write a collection of log entries, you can provide the log name,\nresource, and/or labels hash to be used for all of the entries, and omit\nthese values from the individual entries.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">logging</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">logging</span>\n\n<span class=\"n\">entry1</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">entry</span>\n<span class=\"n\">entry1</span><span class=\"p\">.</span><span class=\"nf\">payload</span> <span class=\"o\">=</span> <span class=\"s2\">\"Job started.\"</span>\n<span class=\"n\">entry2</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">entry</span>\n<span class=\"n\">entry2</span><span class=\"p\">.</span><span class=\"nf\">payload</span> <span class=\"o\">=</span> <span class=\"s2\">\"Job completed.\"</span>\n<span class=\"n\">labels</span> <span class=\"o\">=</span> <span class=\"p\">{</span> <span class=\"ss\">job_size: </span><span class=\"s2\">\"large\"</span><span class=\"p\">,</span> <span class=\"ss\">job_code: </span><span class=\"s2\">\"red\"</span> <span class=\"p\">}</span>\n\n<span class=\"n\">resource</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">resource</span> <span class=\"s2\">\"gae_app\"</span><span class=\"p\">,</span>\n                            <span class=\"s2\">\"module_id\"</span> <span class=\"o\">=&gt;</span> <span class=\"s2\">\"1\"</span><span class=\"p\">,</span>\n                            <span class=\"s2\">\"version_id\"</span> <span class=\"o\">=&gt;</span> <span class=\"s2\">\"20150925t173233\"</span>\n\n<span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">write_entries</span> <span class=\"p\">[</span><span class=\"n\">entry1</span><span class=\"p\">,</span> <span class=\"n\">entry2</span><span class=\"p\">],</span>\n                      <span class=\"ss\">log_name: </span><span class=\"s2\">\"my_app_log\"</span><span class=\"p\">,</span>\n                      <span class=\"ss\">resource: </span><span class=\"n\">resource</span><span class=\"p\">,</span>\n                      <span class=\"ss\">labels: </span><span class=\"n\">labels</span>\n</code></pre>\n</div>\n\n<h3 id=\"creating-a-ruby-logger-implementation\">Creating a Ruby Logger implementation</h3>\n\n<p>If your environment requires a logger instance that is API-compatible with\nRuby’s standard library\n<a href=\"http://ruby-doc.org/stdlib/libdoc/logger/rdoc\">Logger</a>, you can use\n<a data-custom-type=\"gcloud/logging/project~logger\">Gcloud::Logging::Project#logger</a> to create one.</p>\n\n<div class=\"highlighter-rouge\"><pre class=\"ruby\"><code><span class=\"nb\">require</span> <span class=\"s2\">\"gcloud\"</span>\n\n<span class=\"n\">gcloud</span> <span class=\"o\">=</span> <span class=\"no\">Gcloud</span><span class=\"p\">.</span><span class=\"nf\">new</span>\n<span class=\"n\">logging</span> <span class=\"o\">=</span> <span class=\"n\">gcloud</span><span class=\"p\">.</span><span class=\"nf\">logging</span>\n\n<span class=\"n\">resource</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">resource</span> <span class=\"s2\">\"gae_app\"</span><span class=\"p\">,</span>\n                            <span class=\"ss\">module_id: </span><span class=\"s2\">\"1\"</span><span class=\"p\">,</span>\n                            <span class=\"ss\">version_id: </span><span class=\"s2\">\"20150925t173233\"</span>\n\n<span class=\"n\">logger</span> <span class=\"o\">=</span> <span class=\"n\">logging</span><span class=\"p\">.</span><span class=\"nf\">logger</span> <span class=\"s2\">\"my_app_log\"</span><span class=\"p\">,</span> <span class=\"n\">resource</span><span class=\"p\">,</span> <span class=\"ss\">env: :production</span>\n<span class=\"n\">logger</span><span class=\"p\">.</span><span class=\"nf\">info</span> <span class=\"s2\">\"Job started.\"</span>\n</code></pre>\n</div>","source":"lib/gcloud/logging.rb#L302","resources":[],"examples":[],"methods":[]}